import{j as u,A as b,m as y}from"./ui-D_LkVF2r.js";import{r as m}from"./vendor-Vqvh67Lm.js";const v=({options:c,value:e,onChange:r,placeholder:i="선택하세요",label:o,disabled:a=!1,className:l=""})=>{const[t,s]=m.useState(!1),d=m.useRef(null),f=c.find(n=>n.value===e);m.useEffect(()=>{const n=p=>{d.current&&!d.current.contains(p.target)&&s(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const h=n=>{r(n),s(!1)};return u.jsxs("div",{className:`relative ${l}`,ref:d,children:[o&&u.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:o}),u.jsxs("button",{type:"button",onClick:()=>!a&&s(!t),disabled:a,className:`
          w-full flex items-center justify-between
          px-4 py-2.5 rounded-lg
          bg-gray-700 border border-gray-600
          text-left transition-all duration-200
          ${a?"opacity-50 cursor-not-allowed":"hover:border-purple-500 cursor-pointer"}
          ${t?"ring-2 ring-purple-500 border-purple-500":""}
        `,children:[u.jsx("span",{className:f?"text-white":"text-gray-400",children:f?u.jsxs("span",{className:"flex items-center gap-2",children:[f.icon,f.label]}):i}),u.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform duration-200 ${t?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u.jsx(b,{children:t&&u.jsx(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute z-50 w-full mt-2 py-1 bg-gray-800 border border-gray-700 rounded-lg shadow-xl max-h-60 overflow-auto",children:c.map(n=>u.jsxs("button",{onClick:()=>!n.disabled&&h(n.value),disabled:n.disabled,className:`
                  w-full px-4 py-2.5 text-left flex items-center gap-2
                  transition-colors duration-150
                  ${n.disabled?"opacity-50 cursor-not-allowed":"hover:bg-gray-700 cursor-pointer"}
                  ${n.value===e?"bg-purple-600/20 text-purple-400":"text-white"}
                `,children:[n.icon,n.label]},n.value))})})]})};function N(c){let e=c.trim();e.startsWith("```json")?e=e.slice(7):e.startsWith("```")&&(e=e.slice(3)),e.endsWith("```")&&(e=e.slice(0,-3)),e=e.trim();const r=e.indexOf("{");r>0&&(e=e.slice(r));try{return JSON.parse(e)}catch{return console.warn("JSON parsing failed, attempting recovery..."),g(e)}}function g(c){let e=c;const r=j(e);r>0&&(e=e.substring(0,r));let i=0,o=0,a=!1,l=!1;for(const t of e){if(l){l=!1;continue}if(t==="\\"){l=!0;continue}if(t==='"'){a=!a;continue}a||(t==="{"&&i++,t==="}"&&i--,t==="["&&o++,t==="]"&&o--)}for(e=e.replace(/,\s*$/,"");o>0;)e+="]",o--;for(;i>0;)e+="}",i--;try{return JSON.parse(e)}catch{const s=e.match(/"(characters|episodes|acts|panels)":\s*\[/);if(s){const f=s[1],h=e.indexOf(s[0]),n=e.indexOf("[",h),p=w(e.substring(n+1));if(p.length>0){const x=`{"${f}":[${p.join(",")}]}`;try{return JSON.parse(x)}catch{}}}const d=e.match(/^(\{[\s\S]*"(?:characters|episodes|acts|panels)":\s*\[[\s\S]*\})\s*,?\s*(?:\{[^}]*)?$/);if(d)try{let f=d[1];return f.endsWith("]")||(f+="]"),f.endsWith("}")||(f+="}"),JSON.parse(f)}catch{}throw new Error("JSON 파싱 실패: AI 응답이 불완전합니다. 다시 시도해주세요.")}}function j(c){let e=-1,r=0,i=!1,o=!1,a=!1,l=-1;for(let t=0;t<c.length;t++){const s=c[t];if(o){o=!1;continue}if(s==="\\"){o=!0;continue}if(s==='"'){i=!i;continue}i||(s==="["?a=!0:s==="{"?(a&&r===1&&(l=t),r++):s==="}"?(r--,a&&r===1&&l!==-1&&(e=t+1)):s==="]"&&r===1&&(a=!1))}return e}function w(c){const e=[];let r=0,i=-1,o=!1,a=!1;for(let l=0;l<c.length;l++){const t=c[l];if(a){a=!1;continue}if(t==="\\"){a=!0;continue}if(t==='"'){o=!o;continue}if(!o){if(t==="{")r===0&&(i=l),r++;else if(t==="}"&&(r--,r===0&&i!==-1)){const s=c.substring(i,l+1);try{JSON.parse(s),e.push(s)}catch{}i=-1}}}return e}export{v as D,N as p};
