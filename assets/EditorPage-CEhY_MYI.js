import{j as e,m as te,A as hs}from"./ui-D_LkVF2r.js";import{r as re,e as us,u as ps}from"./vendor-Vqvh67Lm.js";import{B as O}from"./Button-C3O7gUUW.js";import{u as ns,c as Qe,L as is,d as xs}from"./index-BJasgfCK.js";import{D as ss,p as ts}from"./parseJsonResponse-BC4W7KvA.js";import{g as _e,C as Ze}from"./GeminiService-CuSaiY5Y.js";import"./storage-BBQgdv-R.js";import"./ai-BpRkNtKl.js";const os=({tabs:s,activeTab:g,onChange:t,variant:o="default",size:u="md",fullWidth:d=!1,className:p=""})=>{const r={sm:"px-3 py-1.5 text-sm gap-1.5",md:"px-4 py-2 text-base gap-2",lg:"px-5 py-2.5 text-lg gap-2.5"};return(()=>{switch(o){case"pills":return e.jsx("div",{className:`flex gap-2 ${d?"w-full":""} ${p}`,children:s.map(a=>e.jsxs("button",{onClick:()=>!a.disabled&&t(a.id),disabled:a.disabled,className:`
                  flex items-center ${r[u]} rounded-lg
                  font-medium transition-all duration-200
                  ${d?"flex-1 justify-center":""}
                  ${a.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                  ${g===a.id?"bg-purple-600 text-white":"bg-gray-700 text-gray-400 hover:text-white hover:bg-gray-600"}
                `,children:[a.icon,a.label]},a.id))});case"underline":return e.jsx("div",{className:`flex border-b border-gray-700 ${d?"w-full":""} ${p}`,children:s.map(a=>e.jsxs("button",{onClick:()=>!a.disabled&&t(a.id),disabled:a.disabled,className:`
                  relative flex items-center ${r[u]}
                  font-medium transition-colors duration-200
                  ${d?"flex-1 justify-center":""}
                  ${a.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                  ${g===a.id?"text-purple-400":"text-gray-400 hover:text-white"}
                `,children:[a.icon,a.label,g===a.id&&e.jsx(te.div,{layoutId:"underline",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-purple-500"})]},a.id))});default:return e.jsx("div",{className:`
              flex bg-gray-800 rounded-lg p-1
              ${d?"w-full":"inline-flex"}
              ${p}
            `,children:s.map(a=>e.jsxs("button",{onClick:()=>!a.disabled&&t(a.id),disabled:a.disabled,className:`
                  relative flex items-center ${r[u]} rounded-md
                  font-medium transition-all duration-200
                  ${d?"flex-1 justify-center":""}
                  ${a.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                  ${g===a.id?"text-white":"text-gray-400 hover:text-white"}
                `,children:[g===a.id&&e.jsx(te.div,{layoutId:"activeTab",className:"absolute inset-0 bg-gray-700 rounded-md",transition:{type:"spring",stiffness:500,damping:30}}),e.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[a.icon,a.label]})]},a.id))})}})()};async function fs(s,g){const{text:t,fontSize:o=26,fontFamily:u="'Noto Sans KR', 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif",maxWidth:d=400,bubbleStyle:p="normal"}=g;return t.trim()?new Promise((r,b)=>{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{const f=document.createElement("canvas").getContext("2d");if(!f){b(new Error("Canvas context not available"));return}f.font=`bold ${o}px ${u}`;const ae=ys(f,t,d),J=o*1.5,$e=ae.length*J,H=20,U=$e+H*2,G=document.createElement("canvas"),y=G.getContext("2d");if(!y){b(new Error("Canvas context not available"));return}G.width=a.width,G.height=a.height+U,y.fillStyle="#ffffff",y.fillRect(0,0,G.width,U),y.strokeStyle="#e0e0e0",y.lineWidth=1,y.beginPath(),y.moveTo(0,U),y.lineTo(G.width,U),y.stroke(),y.drawImage(a,0,U),y.font=`bold ${o}px ${u}`,y.textAlign="center",y.textBaseline="top",p==="shout"?y.fillStyle="#d32f2f":p==="thought"?y.fillStyle="#666666":y.fillStyle="#1a1a1a";const le=H;ae.forEach((ge,i)=>{y.fillText(ge,G.width/2,le+i*J)}),r(G.toDataURL("image/png"))},a.onerror=()=>{b(new Error("Failed to load image"))},a.src=s}):s}function ys(s,g,t){const o=[],u=g.split(/\\n|\n/);for(const d of u){if(!d.trim()){o.push("");continue}const p=d.split(/(\s+)/);let r="";for(const b of p){if(!b)continue;const a=r+b;if(s.measureText(a).width>t&&r.length>0){if(o.push(r.trim()),r=b,s.measureText(b).width>t){const f=b.split("");r="";for(const ae of f){const J=r+ae;s.measureText(J).width>t&&r.length>0?(o.push(r),r=ae):r=J}}}else r=a}r.trim()&&o.push(r.trim())}return o}const bs=[{value:"full",label:"ì „ì²´"},{value:"large",label:"ëŒ€í˜•"},{value:"medium",label:"ì¤‘í˜•"},{value:"small",label:"ì†Œí˜•"},{value:"wide",label:"ê°€ë¡œí˜•"},{value:"tall",label:"ì„¸ë¡œí˜•"}],vs=[{value:"close-up",label:"í´ë¡œì¦ˆì—…"},{value:"medium-shot",label:"ë¯¸ë””ì—„ìƒ·"},{value:"wide-shot",label:"ì™€ì´ë“œìƒ·"},{value:"extreme-close-up",label:"ìµìŠ¤íŠ¸ë¦¼ í´ë¡œì¦ˆì—…"},{value:"bird-eye",label:"ë²„ë“œì•„ì´"},{value:"worm-eye",label:"ì›œì•„ì´"},{value:"dutch-angle",label:"ë”ì¹˜ì•µê¸€"},{value:"over-shoulder",label:"ì˜¤ë²„ìˆ„ë”"},{value:"pov",label:"POV"}],ws=({panel:s,episodeId:g,onUpdate:t})=>{var G,y,le,ge;const[o,u]=re.useState(!1),[d,p]=re.useState(null),[r,b]=re.useState(""),{currentProject:a}=ns(),{addToast:v}=Qe(),f=async(i="preview")=>{var E,he,Le,De,Oe,Se,Re,Me,ue,ve,we,ze,Be,n,j,w;if(a){u(!0);try{const $=a.episodes.find(C=>C.panels.some(c=>c.id===s.id)),X=($==null?void 0:$.panels.findIndex(C=>C.id===s.id))??-1;let Ne="",pe={};if($&&X>0){const C=Math.max(0,X-10),c=$.panels.slice(C,X);if(c.forEach(A=>{A.characters.forEach(K=>{const Q=a.characters.find(k=>k.name===K.characterName||k.koreanName===K.characterName);if(Q&&!pe[Q.name]){const k=Q.appearance||{},L=k.distinguishingFeatures||[],h=k.hairColor||"black",W=k.hairStyle||"",xe=k.eyeColor||"dark brown",fe=k.eyeShape||"",Ue=k.skinTone||"fair",Te=k.faceShape||"",Ie=k.bodyType||"",ye=k.height||"",We=L.some(I=>/ì•ˆê²½|glasses|çœ¼é¡/i.test(I)),Ve=L.some(I=>/ì |mole|beauty mark/i.test(I)),be=L.some(I=>/í‰í„°|scar|ìƒì²˜/i.test(I)),qe=L.some(I=>/ë¬¸ì‹ |tattoo/i.test(I)),Je=L.some(I=>/í”¼ì–´ì‹±|piercing|ê·€ê±¸ì´|earring/i.test(I)),Ge=L.some(I=>/ì•žë¨¸ë¦¬|bangs|fringe/i.test(I)),Xe=L.some(I=>/ìˆ˜ì—¼|beard|mustache/i.test(I));let se="";/ë¬¶|ponytail|bun|tied|updo|ì˜¬ë¦°|twintail|íŠ¸ìœˆ/i.test(W)?se="TIED/PONYTAIL":/ë‹¨ë°œ|short|bob|ìˆ|pixie/i.test(W)?se="SHORT":/ííŠ¸ëŸ¬|messy|disheveled|unkempt|í—í´/i.test(W)?se="MESSY":/ê¸´|long|ë¡±|waist|í—ˆë¦¬/i.test(W)?se="LONG":/ì›¨ì´ë¸Œ|wave|curly|ê³±ìŠ¬/i.test(W)?se="WAVY/CURLY":/ìŠ¤íŠ¸ë ˆì´íŠ¸|straight|ìƒë¨¸ë¦¬/i.test(W)&&(se="STRAIGHT");let V=`${h} ${W} hair`;se&&(V+=` [${se}]`),V+=`, ${xe} eyes`,fe&&(V+=` (${fe})`),V+=`, ${Ue} skin`,Te&&(V+=`, ${Te} face`),Ie&&(V+=`, ${Ie} build`),ye&&(V+=`, ${ye}`);const q=[];We&&q.push("GLASSES"),Ve&&q.push("MOLE/BEAUTY MARK"),be&&q.push("SCAR"),qe&&q.push("TATTOO"),Je&&q.push("PIERCING/EARRINGS"),Ge&&q.push("BANGS"),Xe&&q.push("BEARD/MUSTACHE"),q.length>0&&(V+=` | MUST HAVE: ${q.join(", ")}`);const Ae=L.filter(I=>!/ì•ˆê²½|glasses|ì |mole|í‰í„°|scar|ë¬¸ì‹ |tattoo|í”¼ì–´ì‹±|piercing|ê·€ê±¸ì´|earring|ì•žë¨¸ë¦¬|bangs|ìˆ˜ì—¼|beard/i.test(I));Ae.length>0&&(V+=` | Other: ${Ae.join(", ")}`),pe[Q.name]=V}})}),c.length>0){const A=Object.entries(pe).map(([k,L])=>`â€¢ ${k}: ${L}`).join(`
`),K=c.slice(-3),Q=K.map((k,L)=>{var xe;const h=X-(K.length-L),W=k.characters.map(fe=>fe.characterName).join(", ");return`Panel ${h}: ${((xe=k.composition)==null?void 0:xe.slice(0,80))||"no description"} [${W}]`}).join(`
`);Ne=`

â•â•â• CHARACTER CONSISTENCY REFERENCE (from previous 10 panels) â•â•â•
${A}

RECENT SCENE CONTEXT:
${Q}

âš ï¸ CRITICAL CONSISTENCY RULES:
1. HAIR: Same color, length, and style (tied/loose/short/long) - NO changes
2. FACE: Same shape, skin tone, eye color and shape - NO changes
3. ACCESSORIES: Glasses, earrings, piercings - MUST remain if character has them
4. FEATURES: Moles, scars, tattoos, bangs, beard - MUST be consistent
5. BODY: Same height and build - NO changes
DO NOT modify ANY character appearance between panels!`}}const D=s.composition||((E=s.background)==null?void 0:E.description)||"",ee=a.worldBuilding,R=(ee==null?void 0:ee.era)||"",B=(ee==null?void 0:ee.setting)||"",m=/í˜„ëŒ€|modern|ì‚¬ë¬´ì‹¤|office|ì•„íŒŒíŠ¸|apartment|ë„ì‹œ|city|ìŠ¤ë§ˆíŠ¸í°|ì»´í“¨í„°|ë…¸íŠ¸ë¶|ë¹Œë”©|building|í•™êµ|school|ì¹´íŽ˜|cafe|ë²„ìŠ¤|bus|ì§€í•˜ì² |subway|ë³‘ì›|hospital/i.test(D),Z=/ê³ ëŒ€|ancient|ê³ êµ¬ë ¤|ì‚¼êµ­|ì¡°ì„ |ê³ ë ¤|í•œë³µ|ì „í†µ|ê¶ê¶|palace|ì„±ê³½|castle|ì´ˆê°€|ì›€ë§‰|í•œì˜¥|hanok/i.test(D),ne=/í˜„ëŒ€|modern|ì‚¬ë¬´ì‹¤|office|ì•„íŒŒíŠ¸|apartment|ë„ì‹œ|city|ìŠ¤ë§ˆíŠ¸í°|ì»´í“¨í„°|ë…¸íŠ¸ë¶/i.test(r),M=/ê³ ëŒ€|ancient|ê³ êµ¬ë ¤|ì‚¼êµ­|ì¡°ì„ |ê³ ë ¤|í•œë³µ|ì „í†µ/i.test(r);let l="",x="",N=!1;m?(l="modern contemporary Korean setting, current day Seoul, modern buildings, urban environment",x="modern Korean fashion, casual modern clothing",N=!1,console.log("[PanelEditor] Scene description requests modern setting - highest priority")):Z?(l="ancient Korean historical setting, traditional architecture",x="traditional Korean hanbok",N=!0,console.log("[PanelEditor] Scene description requests ancient setting - highest priority")):ne?(l="modern contemporary Korean setting, current day Seoul, modern buildings, urban environment",x="modern Korean fashion, casual modern clothing",N=!1,console.log("[PanelEditor] Feedback requests modern setting - overriding worldbuilding")):M?(l="ancient Korean historical setting, traditional architecture",x="traditional Korean hanbok",N=!0,console.log("[PanelEditor] Feedback requests ancient setting")):R.includes("ì² ê¸°")||R.includes("ê³ êµ¬ë ¤")||R.includes("ancient")||R.includes("ì‚¼êµ­")||B.includes("ì² ê¸°")||B.includes("ê³ êµ¬ë ¤")||B.includes("ì‚¼êµ­")?(l="ancient Korean Three Kingdoms period, traditional hanok architecture, wooden structures",x="ancient Korean hanbok, layered silk robes, traditional hair accessories",N=!0,console.log("[PanelEditor] Using worldbuilding era setting (ancient)")):R.includes("ì¡°ì„ ")||B.includes("ì¡°ì„ ")?(l="Joseon Dynasty Korea, traditional hanok, paper windows",x="Joseon era hanbok",N=!0,console.log("[PanelEditor] Using worldbuilding era setting (Joseon)")):R.includes("ê³ ë ¤")||B.includes("ê³ ë ¤")?(l="Goryeo Dynasty Korea, Buddhist temples, traditional architecture",x="Goryeo era traditional clothing",N=!0,console.log("[PanelEditor] Using worldbuilding era setting (Goryeo)")):(R.includes("í˜„ëŒ€")||R.includes("modern")||B.includes("í˜„ëŒ€"))&&(l="modern contemporary Korean setting, current day",x="modern Korean fashion",N=!1,console.log("[PanelEditor] Using worldbuilding era setting (modern)"));const P=N?`

CRITICAL ERA CONSISTENCY: This is a HISTORICAL setting. ABSOLUTELY NO modern elements allowed - no modern buildings, no electricity, no modern clothing, no glasses, no modern hairstyles. Everything must be period-accurate.`:"",S=s.characters.map(C=>{var A,K,Q,k,L,h,W,xe,fe,Ue,Te,Ie;const c=a.characters.find(ye=>ye.name===C.characterName||ye.koreanName===C.characterName);if(c){const ye=c.gender==="female"?"beautiful young Korean woman":c.gender==="male"?"handsome young Korean man":"Korean person",We=c.age||25,Ve=((A=c.appearance)==null?void 0:A.hairColor)||"black",be=((K=c.appearance)==null?void 0:K.hairStyle)||"long",qe=((Q=c.appearance)==null?void 0:Q.eyeColor)||"dark brown",Je=((k=c.appearance)==null?void 0:k.bodyType)||"slim",Ge=((L=c.appearance)==null?void 0:L.height)||"",Xe=((h=c.appearance)==null?void 0:h.skinTone)||"fair",se=((W=c.appearance)==null?void 0:W.faceShape)||"oval",V=((xe=c.appearance)==null?void 0:xe.eyeShape)||"almond",q=((Ue=(fe=c.appearance)==null?void 0:fe.distinguishingFeatures)==null?void 0:Ue.join(", "))||"",Ae=((Te=c.appearance)==null?void 0:Te.defaultOutfit)||"",I=Ae||x||(N?"traditional Korean hanbok":"modern Korean clothing"),ds=c.role==="protagonist"?`elegant ${I}, high quality fabric`:c.role==="antagonist"?`imposing ${I}, dark tones`:I,ms=(((Ie=c.appearance)==null?void 0:Ie.distinguishingFeatures)||[]).some(gs=>/ì•ˆê²½|glasses/i.test(gs))?", MUST BE WEARING GLASSES":"";let Pe="";return/ë¬¶|ponytail|bun|tied|updo|ì˜¬ë¦°/i.test(be)?Pe=" (HAIR TIED UP/PONYTAIL - NOT loose)":/ë‹¨ë°œ|short|bob|ìˆ/i.test(be)?Pe=" (SHORT HAIR - above shoulders)":/ííŠ¸ëŸ¬|messy|disheveled|unkempt|í—í´/i.test(be)?Pe=" (MESSY/DISHEVELED hair)":/ê¸´|long|ë¡±/i.test(be)&&(Pe=" (LONG flowing hair)"),`[CHARACTER: ${c.name}] ${ye}, exactly ${We} years old, MUST have ${Ve} ${be} hair${Pe}, ${qe} ${V} eyes${ms}, ${Xe} skin, ${se} face, ${Je} body${Ge?`, ${Ge}`:""}, wearing ${ds}${q?`. Distinctive features: ${q}`:""}. CRITICAL: Keep this character's face, hairstyle, and accessories (especially glasses) EXACTLY consistent with reference image provided.`}return N?"Korean person in traditional hanbok, period-accurate clothing":"Korean person in modern clothing"}).join(`
`),z=((Le=(he=s.dialogues)==null?void 0:he[0])==null?void 0:Le.text)||"",T=s.mood||"peaceful",F=s.lighting||"natural",Y=s.size||"medium",ie=s.cameraAngle||"medium-shot",ce={natural:"bright natural daylight, clear illumination",sunset:"warm golden hour lighting, orange and pink tones",night:"dark nighttime atmosphere with moonlight, blue shadows",indoor:"soft indoor artificial lighting, warm ambient",dramatic:"high contrast dramatic lighting, deep shadows, strong highlights",soft:"soft diffused lighting, gentle shadows",backlight:"strong backlight creating silhouette effect, rim lighting",neon:"colorful neon glow, cyberpunk atmosphere"},je={happy:"bright cheerful atmosphere, warm colors",sad:"melancholic mood, muted colors, somber tone",angry:"intense aggressive mood, sharp contrasts",romantic:"soft romantic atmosphere, warm pink tones",tense:"suspenseful tension, dramatic shadows",mysterious:"enigmatic mysterious mood, dark atmosphere",comedic:"light humorous tone, exaggerated expressions",peaceful:"calm serene atmosphere, gentle lighting",dramatic:"intense dramatic mood, high contrast",nostalgic:"warm nostalgic feeling, sepia tones"},de={"close-up":"close-up shot focusing on face and expression","extreme-close-up":"extreme close-up on eyes or specific detail","medium-shot":"medium shot showing upper body","wide-shot":"wide establishing shot showing full scene with background","bird-eye":"bird's eye view from above looking down","worm-eye":"low angle worm's eye view looking up","dutch-angle":"tilted dutch angle creating unease","over-shoulder":"over the shoulder perspective",pov:"first person point of view"},me=ce[F]||"natural lighting",ke=je[T]||"neutral atmosphere",_=de[ie]||"medium shot",Ee=r?`

**CRITICAL USER FEEDBACK (MUST APPLY)**: ${r}
This feedback overrides any conflicting settings above.`:"",He=/\[CHARACTER:/i.test(D),es=!He&&(/\[LOCATION:.*\]$/i.test(D.trim())||/\[SCENE:.*darkness|.*black|.*fade|.*transition\]/i.test(D)||/\[FOCUS:(?!.*person|.*face|.*eye|.*hand|.*finger).*\]/i.test(D)||/cityscape|skyline|landscape|establishing shot|background only|no character/i.test(D)||/í™˜ê²½ìƒ·|ë°°ê²½ë§Œ|ë„ì‹œ ì „ê²½|í•˜ëŠ˜ë§Œ|ë¹Œë”©ë§Œ|ê±´ë¬¼ë§Œ|í’ê²½/i.test(D)),Ce=es&&s.characters.length===0,ls=Ce?`

âš ï¸ THIS IS A BACKGROUND/ENVIRONMENT SHOT - DO NOT draw any people, characters, or human figures. Focus ONLY on the environment, scenery, and atmosphere.`:"";console.log("[PanelEditor] Scene analysis - hasCharacterInScene:",He,"isBackgroundOnlyScene:",es,"shouldExcludeCharacters:",Ce);const Fe=`Webtoon illustration, Korean manhwa style, clean detailed lineart, cel-shading, professional quality.

ðŸš«ðŸš«ðŸš« CRITICAL - NO TEXT ALLOWED ðŸš«ðŸš«ðŸš«
DO NOT draw ANY text, letters, words, speech bubbles, captions, signs, or Korean/English/Japanese characters.
NO í•œê¸€, NO hangul, NO writing of any kind. The image must be COMPLETELY TEXT-FREE.
Text will be added separately later. Drawing text will RUIN the image.
${ls}

SCENE DESCRIPTION:
${D}

VISUAL STYLE:
- Panel type: ${Y} panel
- Camera: ${_}
- Lighting: ${me}
- Mood/Atmosphere: ${ke}

${!Ce&&S?`CHARACTERS IN SCENE:
${S}`:""}

${l?`SETTING/ERA: ${l}`:""}
${x?`COSTUME STYLE: ${x}`:""}
${P}
${Ce?"":Ne}
${Ee}

IMPORTANT: ${Ce?"This is a BACKGROUND ONLY shot - NO characters or people.":"Maintain visual consistency with character appearances."} Use ${_} composition. Create ${ke} with ${me}.
REMINDER: NO TEXT, NO LETTERS, NO SPEECH BUBBLES - pure illustration only.`;console.log("[PanelEditor] Generated prompt:",Fe);const oe=[];if(Ce)console.log("[PanelEditor] Skipping character reference images - background only scene");else for(const C of s.characters){const c=a.characters.find(A=>A.name===C.characterName||A.koreanName===C.characterName);if(c){const A=((De=c.referenceImages)==null?void 0:De.filter(h=>h.type==="anchor"))||[];for(const h of A.slice(0,2))oe.push(h.imageData);const K=((Oe=c.expressions)==null?void 0:Oe.filter(h=>h.imageData))||[];for(const h of K.slice(0,1))h.imageData&&oe.push(h.imageData);const Q=((Se=c.poses)==null?void 0:Se.filter(h=>h.imageData))||[];for(const h of Q.slice(0,1))h.imageData&&oe.push(h.imageData);const k=((Re=c.outfits)==null?void 0:Re.filter(h=>h.imageData))||[];for(const h of k.slice(0,1))h.imageData&&oe.push(h.imageData);const L=((Me=c.referenceImages)==null?void 0:Me.filter(h=>h.type!=="anchor"))||[];for(const h of L.slice(0,1))oe.push(h.imageData)}}if((ue=a.worldBuilding)!=null&&ue.mainLocations){const C=((we=(ve=s.background)==null?void 0:ve.description)==null?void 0:we.toLowerCase())||"";for(const c of a.worldBuilding.mainLocations)if(C.includes(c.name.toLowerCase())){for(const A of c.variations||[])if(A.generatedImage){oe.push(A.generatedImage);break}}}if($&&X>0){const C=Math.max(0,X-5),c=$.panels.slice(C,X);for(let A=c.length-1;A>=0;A--){const K=c[A];(ze=K.generatedImage)!=null&&ze.imageData&&oe.length<12&&oe.push(K.generatedImage.imageData)}}const cs=oe.slice(0,14),Ke=await _e.generateImage(Fe,{resolution:i,styleAnchor:"",referenceImages:cs,useCache:!1});let Ye=Ke.imageData;if(z)try{const C=(n=(Be=s.dialogues)==null?void 0:Be[0])==null?void 0:n.bubbleStyle,c=C==="thought"||C==="shout"?C:"normal";Ye=await fs(Ke.imageData,{text:z,position:((w=(j=s.dialogues)==null?void 0:j[0])==null?void 0:w.position)||{x:50,y:15},fontSize:28,bubbleStyle:c})}catch(C){console.error("Speech bubble rendering failed:",C)}i==="preview"?p(Ye):(t({generatedImage:{id:Date.now().toString(),resolution:i,imageData:Ye,promptUsed:Fe,generatedAt:new Date,fromCache:Ke.fromCache,cost:Ke.cost},status:"approved"}),p(null)),v({message:i==="preview"?"í”„ë¦¬ë·°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤":"ê³ í•´ìƒë„ ì´ë¯¸ì§€ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤",type:"success"})}catch($){console.error("Image generation failed:",$),v({message:"ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",type:"error"})}finally{u(!1)}}},ae=()=>{d&&(t({generatedImage:{id:Date.now().toString(),resolution:"preview",imageData:d,promptUsed:s.visualPrompt,generatedAt:new Date,fromCache:!1,cost:.001},status:"approved"}),p(null))},J=((y=(G=s.dialogues)==null?void 0:G[0])==null?void 0:y.text)||"",$e={"close-up":"í´ë¡œì¦ˆì—…","extreme-close-up":"ìµìŠ¤íŠ¸ë¦¼","medium-shot":"ë¯¸ë””ì—„","wide-shot":"ì™€ì´ë“œ","bird-eye":"ë²„ë“œì•„ì´","worm-eye":"ì›œì•„ì´","dutch-angle":"ë”ì¹˜","over-shoulder":"ì˜¤ë²„ìˆ„ë”",pov:"POV"},H={happy:"ë°ìŒ",sad:"ìŠ¬í””",angry:"ë¶„ë…¸",romantic:"ë¡œë§¨í‹±",tense:"ê¸´ìž¥",mysterious:"ë¯¸ìŠ¤í„°ë¦¬",comedic:"ì½”ë¯¹",peaceful:"í‰í™”",dramatic:"ê·¹ì ",nostalgic:"í–¥ìˆ˜"},U={natural:"ìžì—°ê´‘",sunset:"ì„ì–‘",night:"ì•¼ê°„",indoor:"ì‹¤ë‚´",dramatic:"ê·¹ì ",soft:"ì†Œí”„íŠ¸",backlight:"ì—­ê´‘",neon:"ë„¤ì˜¨"};return e.jsxs("div",{className:"bg-gray-800/50 rounded-xl border border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xl font-bold text-purple-400",children:["#",s.panelNumber]}),((ge=(le=s.characters)==null?void 0:le[0])==null?void 0:ge.characterName)&&e.jsx("span",{className:"text-sm text-gray-300",children:s.characters[0].characterName}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-400 text-xs rounded-full",children:$e[s.cameraAngle]||s.cameraAngle}),s.mood&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-500/20 text-purple-400 text-xs rounded-full",children:H[s.mood]||s.mood}),s.lighting&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-400 text-xs rounded-full",children:U[s.lighting]||s.lighting})]})]}),e.jsx(ss,{options:bs,value:s.size,onChange:i=>t({size:i}),placeholder:"í¬ê¸°"})]}),e.jsxs("div",{className:"p-4",children:[J&&e.jsxs("div",{className:"mb-4 p-3 bg-white/10 rounded-lg border-l-4 border-purple-500",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"ðŸ’¬ ëŒ€ì‚¬"}),e.jsxs("p",{className:"text-white text-lg font-medium",children:['"',J,'"']})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"aspect-[4/3] bg-gray-900 rounded-lg overflow-hidden relative",children:e.jsx(hs,{mode:"wait",children:o?e.jsx(te.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(is,{size:"lg",className:"mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"ì´ë¯¸ì§€ ìƒì„± ì¤‘..."})]})},"loading"):d?e.jsx(te.img,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},src:d,alt:"Preview",className:"w-full h-full object-contain bg-gray-950"},"preview"):s.generatedImage?e.jsx(te.img,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},src:s.generatedImage.imageData,alt:`Panel ${s.panelNumber}`,className:"w-full h-full object-contain bg-gray-950"},"generated"):e.jsx(te.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-5xl mb-3 block",children:"ðŸŽ¨"}),e.jsx("p",{className:"text-gray-400",children:"ì´ë¯¸ì§€ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”"})]})},"empty")})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ss,{label:"ì•µê¸€",options:vs,value:s.cameraAngle,onChange:i=>t({cameraAngle:i})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"ìž¥ë©´ ì„¤ëª…"}),e.jsx("textarea",{value:s.composition,onChange:i=>t({composition:i.target.value}),rows:3,className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm resize-none",placeholder:"ìž¥ë©´ ì„¤ëª…..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-400 mb-1",children:["ëŒ€ì‚¬ ìˆ˜ì • ",e.jsx("span",{className:"text-gray-500",children:"(ì¤„ë°”ê¿ˆ: \\n ë˜ëŠ” ì—”í„°)"})]}),e.jsx("textarea",{value:J,onChange:i=>{var he;const E=(he=s.dialogues)!=null&&he.length?[{...s.dialogues[0],text:i.target.value}]:[{id:`dlg-${Date.now()}`,text:i.target.value,type:"speech",bubbleStyle:"normal",position:{x:50,y:20},size:{width:200,height:80},fontSize:"medium"}];t({dialogues:E})},rows:3,className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm resize-none",placeholder:"ìºë¦­í„° ëŒ€ì‚¬ë¥¼ ìž…ë ¥í•˜ì„¸ìš”..."})]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-700/50 rounded-lg",children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"âœï¸ ê·¸ë¦¼ ë³´ì™„ì  (ìž¬ìƒì„± ì‹œ ë°˜ì˜)"}),e.jsx("textarea",{value:r,onChange:i=>b(i.target.value),rows:2,className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm resize-none mb-3",placeholder:"ì˜ˆ: í‘œì •ì„ ë” ë°ê²Œ, ë°°ê²½ì„ ì–´ë‘¡ê²Œ, ì•µê¸€ì„ í´ë¡œì¦ˆì—…ìœ¼ë¡œ... (ëŒ€ì‚¬ëŠ” ìœ„ 'ëŒ€ì‚¬ ìˆ˜ì •'ì— ìž…ë ¥)"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(O,{variant:"primary",onClick:()=>f("preview"),disabled:o,loading:o,children:s.generatedImage||d?"ðŸ”„ ìž¬ìƒì„±":"ðŸŽ¨ ì´ë¯¸ì§€ ìƒì„±"}),d&&e.jsxs(e.Fragment,{children:[e.jsx(O,{variant:"primary",onClick:ae,size:"sm",children:"âœ“ ìŠ¹ì¸"}),e.jsx(O,{variant:"secondary",onClick:()=>p(null),size:"sm",children:"ì·¨ì†Œ"})]})]})]})]})]})},Ns=({panels:s,selectedPanelId:g,onSelectPanel:t,onDeletePanel:o,onDeleteAllPanels:u})=>e.jsxs("div",{className:"bg-gray-800/50 rounded-xl border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"íƒ€ìž„ë¼ì¸"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:[s.length," íŒ¨ë„"]}),s.length>0&&u&&e.jsx("button",{onClick:()=>{confirm("ëª¨ë“  íŒ¨ë„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&u()},className:"text-xs text-red-400 hover:text-red-300 px-2 py-1 rounded bg-red-500/10 hover:bg-red-500/20",children:"ì „ì²´ ì‚­ì œ"})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[s.map(d=>e.jsxs(te.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>t(d.id),className:`
              group relative flex-shrink-0 w-20 h-28 rounded-lg overflow-hidden border-2 transition-all
              ${g===d.id?"border-purple-500 ring-2 ring-purple-500/30":"border-gray-700 hover:border-gray-600"}
            `,children:[d.generatedImage?e.jsx("img",{src:d.generatedImage.imageData,alt:`Panel ${d.panelNumber}`,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-900 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 text-2xl",children:"ðŸŽ¨"})}),e.jsx("div",{className:"absolute top-1 left-1 w-5 h-5 rounded bg-black/60 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:d.panelNumber})}),o&&e.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),p.preventDefault(),confirm(`íŒ¨ë„ ${d.panelNumber}ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)&&o(d.id)},className:"absolute top-1 right-1 w-5 h-5 rounded bg-red-500/80 hover:bg-red-500 flex items-center justify-center cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"âœ•"})}),e.jsx("div",{className:`absolute bottom-1 right-1 w-2 h-2 rounded-full ${d.status==="approved"?"bg-green-500":d.status==="preview"?"bg-yellow-500":"bg-gray-500"}`}),g===d.id&&e.jsx(te.div,{layoutId:"selectedPanel",className:"absolute inset-0 border-2 border-purple-500 rounded-lg"})]},d.id)),e.jsx("button",{className:"flex-shrink-0 w-20 h-28 rounded-lg border-2 border-dashed border-gray-700 hover:border-gray-600 flex items-center justify-center transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}),js=({projectTitle:s,episodeTitle:g,onSave:t,onPreview:o,onExport:u})=>{const{viewMode:d,setViewMode:p,zoom:r,setZoom:b}=Qe(),a=[{id:"edit",label:"íŽ¸ì§‘"},{id:"preview",label:"ë¯¸ë¦¬ë³´ê¸°"},{id:"split",label:"ë¶„í• "}];return e.jsx("div",{className:"bg-gray-800/80 backdrop-blur-sm border-b border-gray-700 px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-white font-bold",children:s}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"text-gray-300",children:g})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(os,{tabs:a,activeTab:d,onChange:v=>p(v),variant:"pills",size:"sm"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-gray-700 rounded-lg",children:[e.jsx("button",{onClick:()=>b(r-10),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsxs("span",{className:"text-white text-sm w-12 text-center",children:[r,"%"]}),e.jsx("button",{onClick:()=>b(r+10),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(O,{variant:"ghost",size:"sm",onClick:t,children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"ì €ìž¥"]}),e.jsxs(O,{variant:"ghost",size:"sm",onClick:o,children:[e.jsxs("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"ë¯¸ë¦¬ë³´ê¸°"]}),e.jsxs(O,{variant:"primary",size:"sm",onClick:u,children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"ë‚´ë³´ë‚´ê¸°"]})]})]})})};async function ks(s){const t=[...s].sort((a,v)=>a.panelNumber-v.panelNumber).filter(a=>{var v;return(v=a.generatedImage)==null?void 0:v.imageData});if(t.length===0)throw new Error("ë‚´ë³´ë‚¼ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.");const o=await Promise.all(t.map(a=>Cs(a.generatedImage.imageData))),u=Math.max(...o.map(a=>a.width)),d=o.reduce((a,v)=>a+v.height,0),p=document.createElement("canvas"),r=p.getContext("2d");if(!r)throw new Error("Canvas context not available");p.width=u,p.height=d,r.fillStyle="#ffffff",r.fillRect(0,0,p.width,p.height);let b=0;for(const a of o){const v=(u-a.width)/2;r.drawImage(a,v,b),b+=a.height}return p.toDataURL("image/png")}function Cs(s){return new Promise((g,t)=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>g(o),o.onerror=()=>t(new Error("Failed to load image")),o.src=s})}function rs(s,g){const t=document.createElement("a");t.href=s,t.download=g,document.body.appendChild(t),t.click(),document.body.removeChild(t)}async function $s(s){const g=await ks(s.panels),t=`${s.episodeNumber}í™”_${s.title||"episode"}.png`;rs(g,t)}function Ss(s,g){var o;if(!((o=s.generatedImage)!=null&&o.imageData))throw new Error("ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.");const t=`${g}í™”_íŒ¨ë„${s.panelNumber}.png`;rs(s.generatedImage.imageData,t)}async function as(s){const t=[...s.panels].sort((o,u)=>o.panelNumber-u.panelNumber).filter(o=>{var u;return(u=o.generatedImage)==null?void 0:u.imageData});for(const o of t)Ss(o,s.episodeNumber),await new Promise(u=>setTimeout(u,300))}async function Es(s,g){const{format:t}=g;switch(t){case"long-image":await $s(s);break;case"individual":await as(s);break;case"zip":await as(s);break;default:throw new Error("ì§€ì›í•˜ì§€ ì•ŠëŠ” ë‚´ë³´ë‚´ê¸° í˜•ì‹ìž…ë‹ˆë‹¤.")}}const Bs=()=>{const{projectId:s}=us(),g=ps(),{currentProject:t,setCurrentProject:o,updatePanel:u,addPanel:d,deletePanel:p}=ns(),{selectedEpisodeId:r,setSelectedEpisode:b,selectedPanelId:a,setSelectedPanel:v,addToast:f}=Qe(),{user:ae}=xs(),[J,$e]=re.useState(!0),[H,U]=re.useState(!1),[G,y]=re.useState(!1),[le,ge]=re.useState([]);re.useEffect(()=>{(async()=>{s&&(await o(s),$e(!1))})()},[s,o]),re.useEffect(()=>{t!=null&&t.episodes.length&&!r&&b(t.episodes[0].id)},[t,r,b]);const i=t==null?void 0:t.episodes.find(n=>n.id===r),E=i==null?void 0:i.panels.find(n=>n.id===a),he=async(n,j,w=!1)=>{r&&(await u(r,n,j),w&&f({message:"íŒ¨ë„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤",type:"success"}))},Le=async()=>{var n,j;if(!(!i||!t)){U(!0),f({message:"íŒ¨ë„ì„ ìƒì„±í•˜ê³  ìžˆìŠµë‹ˆë‹¤...",type:"info"});try{const w=t.worldBuilding,$=(w==null?void 0:w.era)||"ê³ ëŒ€ í•œêµ­",X=(w==null?void 0:w.setting)||"ì—­ì‚¬ë¬¼",Ne=t.characters.map(m=>{var P,S,z,T,F,Y;const Z=m.gender==="female"?"woman":m.gender==="male"?"man":"person",ne=((P=m.appearance)==null?void 0:P.hairColor)||"black",M=((S=m.appearance)==null?void 0:S.hairStyle)||"long",l=((z=m.appearance)==null?void 0:z.eyeColor)||"dark brown",x=((T=m.appearance)==null?void 0:T.defaultOutfit)||"",N=((Y=(F=m.appearance)==null?void 0:F.distinguishingFeatures)==null?void 0:Y.join(", "))||"";return`${m.name}: ${Z}, ${ne} ${M} hair, ${l} eyes${x?`, wearing ${x}`:""}${N?`, features: ${N}`:""}`}).join(`
`),pe=((n=w==null?void 0:w.mainLocations)==null?void 0:n.map(m=>`${m.name}: ${m.description||""}`).join(`
`))||"",D=70,ee=`ì›¹íˆ° ${i.episodeNumber}í™” íŒ¨ë„ ${D}ê°œ ìƒì„±. JSON ì¶œë ¥.

ìŠ¤í† ë¦¬: ${i.summary}
ë°°ê²½: ${$}, ${X}
ì£¼ìš” ì´ë²¤íŠ¸: ${((j=i.keyEvents)==null?void 0:j.join(", "))||""}

ìºë¦­í„°:
${Ne}

ìž¥ì†Œ:
${pe}

âš ï¸âš ï¸âš ï¸ ë§¤ìš° ì¤‘ìš” - ë°˜ë“œì‹œ ì´ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥ âš ï¸âš ï¸âš ï¸

{"panels":[
{"n":1,"size":"full","camera":"wide-shot","mood":"mysterious","lighting":"night","img":"[LOCATION: ì–´ë‘ìš´ ì‚¬ë¬´ì‹¤, ëª¨ë‹ˆí„° ë¶ˆë¹›ë§Œ ë¹„ì¹¨] [CHARACTER: í•˜ëŠ˜, 20ëŒ€ ì—¬ì„±, ê²€ì€ ê¸´ ë¨¸ë¦¬ ííŠ¸ëŸ¬ì§, ë‹¤í¬ì„œí´, í›„ë“œí‹°] [ATMOSPHERE: ìƒˆë²½ 3ì‹œ, ì°¨ê°€ìš´ ëª¨ë‹ˆí„° ë¹›]","dialog":""},
{"n":2,"size":"small","camera":"extreme-close-up","mood":"tense","lighting":"dramatic","img":"[FOCUS: ë””ì§€í„¸ ì‹œê³„ 03:42 AM]","dialog":""},
{"n":3,"size":"medium","camera":"medium-shot","mood":"sad","lighting":"indoor","img":"[CHARACTER: í•˜ëŠ˜, ì§€ì¹œ í‘œì •ìœ¼ë¡œ í‚¤ë³´ë“œ íƒ€ì´í•‘]","dialog":"ì  ìž¥..."}
]}

ðŸ“Œ ê° íŒ¨ë„ì— ë°˜ë“œì‹œ í¬í•¨í•  6ê°œ í•„ë“œ:
- "n": íŒ¨ë„ ë²ˆí˜¸ (1-${D})
- "size": full/large/medium/small/wide ì¤‘ í•˜ë‚˜
- "camera": close-up/extreme-close-up/medium-shot/wide-shot/bird-eye/worm-eye/dutch-angle/over-shoulder ì¤‘ í•˜ë‚˜
- "mood": happy/sad/angry/romantic/tense/mysterious/comedic/peaceful/dramatic/nostalgic ì¤‘ í•˜ë‚˜
- "lighting": natural/sunset/night/indoor/dramatic/soft/backlight/neon ì¤‘ í•˜ë‚˜
- "img": ì˜ì–´ë¡œ ìƒì„¸í•œ ìž¥ë©´ ì„¤ëª…
- "dialog": í•œêµ­ì–´ ëŒ€ì‚¬ ë˜ëŠ” ""

ðŸ“Š ë‹¤ì–‘í•˜ê²Œ ì‚¬ìš©í•´ì•¼ í•  ë¹„ìœ¨:
- size: full 10ê°œ, large 15ê°œ, medium 30ê°œ, small 15ê°œ
- camera: ë‹¤ì–‘í•œ ì•µê¸€ì„ ì”¬ì— ë§žê²Œ ì‚¬ìš©
- mood: ìž¥ë©´ ê°ì •ì— ë§žê²Œ ë³€ê²½
- lighting: ì‹œê°„ëŒ€ì™€ ë¶„ìœ„ê¸°ì— ë§žê²Œ ë³€ê²½

ðŸŽ¨ img í•„ë“œ ìž‘ì„±ë²• (ì˜ì–´ë¡œ):
[LOCATION: ìž¥ì†Œ ìƒì„¸ - ê±´ë¬¼, ê°€êµ¬, ì†Œí’ˆ]
[CHARACTER: ì´ë¦„, ì„±ë³„, ë‚˜ì´, ë¨¸ë¦¬ìƒ‰+ìŠ¤íƒ€ì¼, ëˆˆìƒ‰, í‘œì •, í¬ì¦ˆ, ì˜ìƒ ìƒì„¸]
[ATMOSPHERE: ì¡°ëª… ë°©í–¥, ê·¸ë¦¼ìž, ë‚ ì”¨]

ê·œì¹™:
1. ì •í™•ížˆ ${D}ê°œ íŒ¨ë„ ìƒì„± (1-${D})
2. ëª¨ë“  íŒ¨ë„ì— size, camera, mood, lighting í•„ë“œ í•„ìˆ˜!
3. imgëŠ” ì˜ì–´ë¡œë§Œ, dialogëŠ” í•œêµ­ì–´ë¡œë§Œ
4. ëŒ€ì‚¬ ì—†ëŠ” ìž¥ë©´ì€ dialogë¥¼ "" ë¡œ
5. JSONë§Œ ì¶œë ¥, { ë¡œ ì‹œìž‘`,R=await _e.generateText(ee,{temperature:.8,maxTokens:32e3,useCache:!1});console.log("[AI Response Raw]:",R);const B=ts(R);if(console.log("[Parsed Result]:",JSON.stringify(B,null,2)),!B.panels||B.panels.length===0)throw new Error("íŒ¨ë„ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");for(const m of B.panels){console.log("[Panel Data]:",JSON.stringify(m,null,2));const Z=m.n||m.panelNumber||1,ne=m.img||m.sceneDescription||"";let M=m.dialog??m.dialogue??m.talk??m.speech??m.text??"";console.log(`[Panel ${Z}] Dialog field:`,m.dialog,"| Dialogue field:",m.dialogue,"| Final:",M);const x=!/[ê°€-íž£]/.test(M)&&/^[a-zA-Z\s,.\-'":;!?]+$/.test(M);M&&x&&(console.log(`[Panel ${Z}] Filtered out English description:`,M),M="");const N=m.who||m.character||"",P=m.size||"medium",S=m.camera||"medium-shot",z=m.mood||"peaceful",T=m.lighting||"natural";console.log(`[Panel ${Z}] AI Values - size: ${m.size}, camera: ${m.camera}, mood: ${m.mood}, lighting: ${m.lighting}`);const F=["full","large","medium","small","wide","tall"],Y=["close-up","medium-shot","wide-shot","extreme-close-up","bird-eye","worm-eye","dutch-angle","over-shoulder","pov"],ie=["happy","sad","angry","romantic","tense","mysterious","comedic","peaceful","dramatic","nostalgic"],ce=["natural","sunset","night","indoor","dramatic","soft","backlight","neon"],je=F.includes(P)?P:"medium",de=Y.includes(S)?S:"medium-shot",me=ie.includes(z)?z:"peaceful",ke=ce.includes(T)?T:"natural";let _="afternoon";T==="night"?_="night":T==="sunset"?_="evening":T==="soft"&&(_="morning");const Ee={episodeId:i.id,panelNumber:Z,size:je,cameraAngle:de,composition:ne,characters:N?[{characterId:"",characterName:N,position:{x:50,y:50},scale:1,expression:"neutral",pose:"standing",action:"",facing:"front",layer:1}]:[],background:{locationName:"",description:ne,timeOfDay:_,weather:"",mood:me,focusPoint:"",depth:je==="wide"||de==="wide-shot"?"deep":de==="close-up"||de==="extreme-close-up"?"shallow":"medium"},dialogues:M?[{id:`dlg-${Date.now()}-${Z}`,text:M,type:"speech",bubbleStyle:"normal",position:{x:50,y:20},size:{width:200,height:80},fontSize:"medium"}]:[],sfx:[],mood:me,lighting:ke,visualPrompt:ne,status:"pending"};await d(i.id,Ee)}await o(s),f({message:`${B.panels.length}ê°œ íŒ¨ë„ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`,type:"success"})}catch(w){console.error("Panel generation failed:",w),f({message:"íŒ¨ë„ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",type:"error"})}finally{U(!1)}}},De=async n=>{r&&(await p(r,n),v(null),f({message:"íŒ¨ë„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤",type:"success"}))},Oe=async()=>{if(i){for(const n of i.panels)await p(i.id,n.id);v(null),f({message:"ëª¨ë“  íŒ¨ë„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤",type:"success"})}},Se=()=>{if(!i)return[];const n=70,j=new Set(i.panels.map($=>$.panelNumber)),w=[];for(let $=1;$<=n;$++)j.has($)||w.push($);return w},Re=()=>{const n=Se();n.length>0?(ge(n),y(!0)):f({message:"ë¹ ì§„ íŒ¨ë„ì´ ì—†ìŠµë‹ˆë‹¤!",type:"success"})},Me=async n=>{if(!(!i||!t||n.length===0)){U(!0),y(!1),f({message:`${n.length}ê°œ ë¹ ì§„ íŒ¨ë„ì„ ìƒì„±í•˜ê³  ìžˆìŠµë‹ˆë‹¤...`,type:"info"});try{const j=t.worldBuilding,w=(j==null?void 0:j.era)||"ê³ ëŒ€ í•œêµ­",$=(j==null?void 0:j.setting)||"ì—­ì‚¬ë¬¼",X=t.characters.map(l=>{var T,F,Y,ie;const x=l.gender==="female"?"woman":l.gender==="male"?"man":"person",N=((T=l.appearance)==null?void 0:T.hairColor)||"black",P=((F=l.appearance)==null?void 0:F.hairStyle)||"long",S=((Y=l.appearance)==null?void 0:Y.eyeColor)||"dark brown",z=((ie=l.appearance)==null?void 0:ie.defaultOutfit)||"";return`${l.name}: ${x}, ${N} ${P} hair, ${S} eyes${z?`, wearing ${z}`:""}`}).join(`
`),Ne=l=>{var S,z;const x=i.panels.find(T=>T.panelNumber===l-1),N=i.panels.find(T=>T.panelNumber===l+1);let P="";return x&&(P+=`Previous panel ${l-1}: ${((S=x.composition)==null?void 0:S.slice(0,100))||"no description"}
`),N&&(P+=`Next panel ${l+1}: ${((z=N.composition)==null?void 0:z.slice(0,100))||"no description"}
`),P},pe=n.map(l=>`Panel ${l} context:
${Ne(l)}`).join(`

`),D=`ë¹ ì§„ íŒ¨ë„ë§Œ ìƒì„±. JSON ì¶œë ¥.

ìŠ¤í† ë¦¬: ${i.summary}
ë°°ê²½: ${w}, ${$}

ìºë¦­í„°:
${X}

ìƒì„±í•  íŒ¨ë„ ë²ˆí˜¸: ${n.join(", ")}

ì•žë’¤ ë¬¸ë§¥:
${pe}

âš ï¸âš ï¸âš ï¸ ë°˜ë“œì‹œ ì´ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥ âš ï¸âš ï¸âš ï¸

{"panels":[
{"n":${n[0]},"size":"medium","camera":"close-up","mood":"tense","lighting":"dramatic","img":"[LOCATION: ìž¥ì†Œ] [CHARACTER: ì´ë¦„, ë¨¸ë¦¬ìƒ‰, í‘œì •, ì˜ìƒ] [ATMOSPHERE: ì¡°ëª…]","dialog":"í•œêµ­ì–´ ëŒ€ì‚¬"}
]}

ðŸ“Œ ê° íŒ¨ë„ì— ë°˜ë“œì‹œ í¬í•¨í•  6ê°œ í•„ë“œ:
- "n": íŒ¨ë„ ë²ˆí˜¸
- "size": full/large/medium/small/wide ì¤‘ í•˜ë‚˜
- "camera": close-up/extreme-close-up/medium-shot/wide-shot/bird-eye/worm-eye/dutch-angle/over-shoulder ì¤‘ í•˜ë‚˜
- "mood": happy/sad/angry/romantic/tense/mysterious/comedic/peaceful/dramatic/nostalgic ì¤‘ í•˜ë‚˜
- "lighting": natural/sunset/night/indoor/dramatic/soft/backlight/neon ì¤‘ í•˜ë‚˜
- "img": ì˜ì–´ë¡œ ìž¥ë©´ ì„¤ëª…
- "dialog": í•œêµ­ì–´ ëŒ€ì‚¬ ë˜ëŠ” ""

ê·œì¹™:
1. ì •í™•ížˆ ${n.join(", ")} ë²ˆ íŒ¨ë„ë§Œ ìƒì„± (${n.length}ê°œ)
2. ëª¨ë“  íŒ¨ë„ì— size, camera, mood, lighting í•„ë“œ í•„ìˆ˜!
3. ì•žë’¤ íŒ¨ë„ê³¼ ìžì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°
4. JSONë§Œ ì¶œë ¥`,ee=await _e.generateText(D,{temperature:.7,maxTokens:16e3,useCache:!1}),R=ts(ee);if(!R.panels||R.panels.length===0)throw new Error("íŒ¨ë„ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");const B=["full","large","medium","small","wide","tall"],m=["close-up","medium-shot","wide-shot","extreme-close-up","bird-eye","worm-eye","dutch-angle","over-shoulder","pov"],Z=["happy","sad","angry","romantic","tense","mysterious","comedic","peaceful","dramatic","nostalgic"],ne=["natural","sunset","night","indoor","dramatic","soft","backlight","neon"];let M=0;for(const l of R.panels){const x=l.n||l.panelNumber;if(!n.includes(x)){console.log(`[Missing Panel] Skipping panel ${x} - not in requested list`);continue}if(i.panels.some(He=>He.panelNumber===x)){console.log(`[Missing Panel] Panel ${x} already exists, skipping`);continue}const P=l.img||l.sceneDescription||"";let S=l.dialog??l.dialogue??"";const T=!/[ê°€-íž£]/.test(S)&&/^[a-zA-Z\s,.\-'":;!?]+$/.test(S);S&&T&&(S="");const F=l.size||"medium",Y=l.camera||"medium-shot",ie=l.mood||"peaceful",ce=l.lighting||"natural",je=B.includes(F)?F:"medium",de=m.includes(Y)?Y:"medium-shot",me=Z.includes(ie)?ie:"peaceful",ke=ne.includes(ce)?ce:"natural";let _="afternoon";ce==="night"?_="night":ce==="sunset"&&(_="evening");const Ee={episodeId:i.id,panelNumber:x,size:je,cameraAngle:de,composition:P,characters:[],background:{locationName:"",description:P,timeOfDay:_,weather:"",mood:me,focusPoint:"",depth:"medium"},dialogues:S?[{id:`dlg-${Date.now()}-${x}`,text:S,type:"speech",bubbleStyle:"normal",position:{x:50,y:20},size:{width:200,height:80},fontSize:"medium"}]:[],sfx:[],mood:me,lighting:ke,visualPrompt:P,status:"pending"};await d(i.id,Ee),M++}await o(s),f({message:`${M}ê°œ ë¹ ì§„ íŒ¨ë„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`,type:"success"})}catch(j){console.error("Missing panel generation failed:",j),f({message:"ë¹ ì§„ íŒ¨ë„ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",type:"error"})}finally{U(!1)}}};if(J)return e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsx(is,{size:"lg"})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsxs(Ze,{className:"text-center p-8",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),e.jsx(O,{variant:"primary",onClick:()=>g("/dashboard"),children:"ëŒ€ì‹œë³´ë“œë¡œ ì´ë™"})]})});const ue=(t==null?void 0:t.episodes.findIndex(n=>n.id===r))??-1,ve=ue>0,we=ue<((t==null?void 0:t.episodes.length)??0)-1,ze=()=>{if(ve&&t){const n=t.episodes[ue-1];b(n.id),n.panels.length>0?v(n.panels[0].id):v(null)}},Be=()=>{if(we&&t){const n=t.episodes[ue+1];b(n.id),n.panels.length>0?v(n.panels[0].id):v(null)}};return e.jsxs("div",{className:"min-h-screen bg-gray-900 flex flex-col",children:[e.jsxs("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>g(`/create/${s}`),className:"text-gray-400 hover:text-white",children:[e.jsx("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"í”„ë¡œì íŠ¸ ì„¤ì •"]}),e.jsx("div",{className:"text-gray-400",children:"|"}),e.jsx("h1",{className:"text-white font-bold",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:ze,disabled:!ve,className:ve?"":"opacity-50 cursor-not-allowed",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"bg-gray-700 rounded-lg px-4 py-2 min-w-[200px] text-center",children:[e.jsx("span",{className:"text-purple-400 font-bold",children:i?`${i.episodeNumber}í™”`:"ì—í”¼ì†Œë“œ ì„ íƒ"}),i&&e.jsxs("span",{className:"text-gray-400 ml-2 text-sm",children:["/ ",t.episodes.length,"í™”"]})]}),e.jsx(O,{variant:"ghost",size:"sm",onClick:Be,disabled:!we,className:we?"":"opacity-50 cursor-not-allowed",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"flex items-center gap-2",children:ae?e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"})}),e.jsx("span",{children:"ìžë™ ë™ê¸°í™” ì¤‘"})]}):e.jsxs("button",{onClick:()=>g("/settings"),className:"flex items-center gap-2 text-gray-400 hover:text-white text-sm transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"})}),e.jsx("span",{children:"ë¡œê·¸ì¸í•˜ì—¬ ë™ê¸°í™”"})]})})]}),e.jsx(js,{projectTitle:t.title,episodeTitle:(i==null?void 0:i.title)||"ì—í”¼ì†Œë“œ ì„ íƒ",onSave:()=>f({message:"ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤ (ìžë™ ì €ìž¥ë¨)",type:"success"}),onPreview:()=>g(`/preview/${s}`),onExport:async()=>{if(!i){f({message:"ì—í”¼ì†Œë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”",type:"error"});return}if(i.panels.filter(j=>{var w;return(w=j.generatedImage)==null?void 0:w.imageData}).length===0){f({message:"ë‚´ë³´ë‚¼ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤",type:"error"});return}try{f({message:"ì´ë¯¸ì§€ë¥¼ ë³‘í•©í•˜ê³  ìžˆìŠµë‹ˆë‹¤...",type:"info"}),await Es(i,{format:"long-image"}),f({message:"ë‚´ë³´ë‚´ê¸° ì™„ë£Œ!",type:"success"})}catch(j){console.error("Export failed:",j),f({message:"ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",type:"error"})}}}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"w-64 bg-gray-800/50 border-r border-gray-700 p-4 overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"ì—í”¼ì†Œë“œ"}),e.jsx("div",{className:"space-y-2",children:t.episodes.length>0?t.episodes.map(n=>e.jsxs(te.button,{whileHover:{x:4},onClick:()=>{b(n.id),n.panels.length>0&&v(n.panels[0].id)},className:`w-full text-left p-3 rounded-lg transition-colors ${r===n.id?"bg-purple-600/30 border border-purple-500":"bg-gray-700/50 hover:bg-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-medium",children:[n.episodeNumber,"í™”"]}),e.jsxs("span",{className:"text-gray-400 text-sm",children:[n.panels.length," íŒ¨ë„"]})]}),e.jsx("p",{className:"text-gray-400 text-sm truncate mt-1",children:n.title})]},n.id)):e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("p",{children:"ì—í”¼ì†Œë“œê°€ ì—†ìŠµë‹ˆë‹¤"}),e.jsx(O,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>{},children:"ì—í”¼ì†Œë“œ ì¶”ê°€"})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"ìºë¦­í„°"}),e.jsx("div",{className:"space-y-2",children:t.characters.map(n=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-gray-700/30",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-sm",children:n.gender==="female"?"ðŸ‘©":"ðŸ‘¨"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm font-medium",children:n.name}),e.jsx("p",{className:"text-gray-400 text-xs",children:n.role})]})]},n.id))})]})]}),e.jsx("div",{className:"flex-1 flex flex-col p-4 overflow-hidden",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Ns,{panels:i.panels,selectedPanelId:a,onSelectPanel:v,onDeletePanel:De,onDeleteAllPanels:Oe}),e.jsxs("div",{className:"flex-1 mt-4 overflow-y-auto",children:[E?e.jsx(ws,{panel:E,episodeId:i.id,onUpdate:n=>he(E.id,n)}):e.jsx(Ze,{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-4xl mb-4 block",children:"ðŸŽ¬"}),e.jsx("p",{className:"text-gray-400 mb-2",children:i.panels.length===0?"ì´ ì—í”¼ì†Œë“œì— íŒ¨ë„ì´ ì—†ìŠµë‹ˆë‹¤":"íŒ¨ë„ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒˆë¡œ ì¶”ê°€í•˜ì„¸ìš”"}),i.panels.length===0&&e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"AIê°€ ì—í”¼ì†Œë“œ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ íŒ¨ë„ì„ ìžë™ ìƒì„±í•©ë‹ˆë‹¤"}),e.jsx(O,{variant:"primary",className:"mt-4",onClick:Le,disabled:H,loading:H,children:H?"AI íŒ¨ë„ ìƒì„± ì¤‘...":"AI íŒ¨ë„ ìžë™ ìƒì„±"})]})}),i.panels.length>0&&e.jsxs("div",{className:"mt-4 flex gap-2 justify-center",children:[e.jsx(O,{variant:"secondary",size:"sm",onClick:Re,disabled:H,children:"ðŸ” ë¹ ì§„ íŒ¨ë„ í™•ì¸"}),e.jsxs(O,{variant:"secondary",size:"sm",onClick:()=>{const n=Se();n.length>0?(ge(n),y(!0)):f({message:"ì´ë¯¸ 70ê°œ íŒ¨ë„ì´ ëª¨ë‘ ìžˆìŠµë‹ˆë‹¤!",type:"success"})},disabled:H,loading:H,children:["âž• íŒ¨ë„ ì¶”ê°€ ìƒì„± (",70-((i==null?void 0:i.panels.length)||0),"ê°œ ë‚¨ìŒ)"]})]})]})]}):e.jsx(Ze,{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-4xl mb-4 block",children:"ðŸ“š"}),e.jsx("p",{className:"text-gray-400",children:"ì—í”¼ì†Œë“œë¥¼ ì„ íƒí•˜ì„¸ìš”"})]})})}),e.jsxs("div",{className:"w-72 bg-gray-800/50 border-l border-gray-700 p-4 overflow-y-auto",children:[e.jsx(os,{tabs:[{id:"properties",label:"ì†ì„±"},{id:"dialogue",label:"ëŒ€ì‚¬"}],activeTab:"properties",onChange:()=>{},variant:"underline",fullWidth:!0}),e.jsx("div",{className:"mt-4",children:E?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"íŒ¨ë„ í¬ê¸°"}),e.jsx("p",{className:"text-white",children:{full:"ì „ì²´",large:"ëŒ€í˜•",medium:"ì¤‘í˜•",small:"ì†Œí˜•",wide:"ê°€ë¡œí˜•",tall:"ì„¸ë¡œí˜•",custom:"ì»¤ìŠ¤í…€"}[E.size]||E.size})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ì¹´ë©”ë¼ ì•µê¸€"}),e.jsx("p",{className:"text-white",children:{"close-up":"í´ë¡œì¦ˆì—…","extreme-close-up":"ìµìŠ¤íŠ¸ë¦¼ í´ë¡œì¦ˆì—…","medium-shot":"ë¯¸ë””ì—„ìƒ·","wide-shot":"ì™€ì´ë“œìƒ·","bird-eye":"ë²„ë“œì•„ì´","worm-eye":"ì›œì•„ì´","dutch-angle":"ë”ì¹˜ì•µê¸€","over-shoulder":"ì˜¤ë²„ìˆ„ë”",pov:"POV"}[E.cameraAngle]||E.cameraAngle})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ë¶„ìœ„ê¸°"}),e.jsx("p",{className:"text-white",children:{happy:"ë°ìŒ ðŸ˜Š",sad:"ìŠ¬í”” ðŸ˜¢",angry:"ë¶„ë…¸ ðŸ˜ ",romantic:"ë¡œë§¨í‹± ðŸ’•",tense:"ê¸´ìž¥ ðŸ˜°",mysterious:"ë¯¸ìŠ¤í„°ë¦¬ ðŸ”®",comedic:"ì½”ë¯¹ ðŸ˜‚",peaceful:"í‰í™” ðŸŒ¿",dramatic:"ê·¹ì  ðŸŽ­",nostalgic:"í–¥ìˆ˜ ðŸŒ…"}[E.mood]||E.mood||"ì—†ìŒ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ì¡°ëª…"}),e.jsx("p",{className:"text-white",children:{natural:"ìžì—°ê´‘ â˜€ï¸",sunset:"ì„ì–‘ ðŸŒ…",night:"ì•¼ê°„ ðŸŒ™",indoor:"ì‹¤ë‚´ ðŸ’¡",dramatic:"ê·¹ì  ðŸŽ¬",soft:"ì†Œí”„íŠ¸ ðŸŒ¤ï¸",backlight:"ì—­ê´‘ âœ¨",neon:"ë„¤ì˜¨ ðŸŒˆ"}[E.lighting]||E.lighting})]}),E.dialogues.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"ëŒ€ì‚¬"}),e.jsx("div",{className:"space-y-2",children:E.dialogues.map(n=>e.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-purple-400",children:n.characterName||"ë‚˜ë ˆì´ì…˜"}),e.jsx("p",{className:"text-white text-sm",children:n.text})]},n.id))})]})]}):e.jsx("p",{className:"text-gray-400 text-center",children:"íŒ¨ë„ì„ ì„ íƒí•˜ì„¸ìš”"})})]})]}),G&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:e.jsxs(te.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4 border border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"ðŸ” ë¹ ì§„ íŒ¨ë„ ë°œê²¬"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"ë‹¤ìŒ íŒ¨ë„ ë²ˆí˜¸ê°€ ë¹ ì ¸ìžˆìŠµë‹ˆë‹¤:"}),e.jsx("div",{className:"bg-gray-900 rounded-lg p-4 mb-4 max-h-48 overflow-y-auto",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:le.map(n=>e.jsxs("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm font-medium",children:["#",n]},n))})}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["ì´ ",le.length,"ê°œì˜ íŒ¨ë„ì´ ë¹ ì ¸ìžˆìŠµë‹ˆë‹¤. AIê°€ ì•žë’¤ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì°¸ê³ í•˜ì—¬ ë¹ ì§„ íŒ¨ë„ì„ ìƒì„±í•©ë‹ˆë‹¤."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(O,{variant:"primary",className:"flex-1",onClick:()=>Me(le),disabled:H,loading:H,children:"ë¹ ì§„ íŒ¨ë„ ìƒì„±"}),e.jsx(O,{variant:"secondary",onClick:()=>y(!1),children:"ì·¨ì†Œ"})]})]})})]})};export{Bs as default};
