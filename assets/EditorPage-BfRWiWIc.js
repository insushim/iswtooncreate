import{j as e,m as se,A as cs}from"./ui-D_LkVF2r.js";import{r as ie,e as ds,u as ms}from"./vendor-Vqvh67Lm.js";import{B as D}from"./Button-C3O7gUUW.js";import{u as ss,c as Ze,L as ts,d as gs}from"./index-DOzPlsuw.js";import{D as _e,p as Qe}from"./parseJsonResponse-BC4W7KvA.js";import{g as Xe,C as Ve}from"./GeminiService-CuSaiY5Y.js";import"./storage-BBQgdv-R.js";import"./ai-BpRkNtKl.js";const as=({tabs:s,activeTab:g,onChange:t,variant:r="default",size:p="md",fullWidth:o=!1,className:h=""})=>{const m={sm:"px-3 py-1.5 text-sm gap-1.5",md:"px-4 py-2 text-base gap-2",lg:"px-5 py-2.5 text-lg gap-2.5"};return(()=>{switch(r){case"pills":return e.jsx("div",{className:`flex gap-2 ${o?"w-full":""} ${h}`,children:s.map(n=>e.jsxs("button",{onClick:()=>!n.disabled&&t(n.id),disabled:n.disabled,className:`
                  flex items-center ${m[p]} rounded-lg
                  font-medium transition-all duration-200
                  ${o?"flex-1 justify-center":""}
                  ${n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                  ${g===n.id?"bg-purple-600 text-white":"bg-gray-700 text-gray-400 hover:text-white hover:bg-gray-600"}
                `,children:[n.icon,n.label]},n.id))});case"underline":return e.jsx("div",{className:`flex border-b border-gray-700 ${o?"w-full":""} ${h}`,children:s.map(n=>e.jsxs("button",{onClick:()=>!n.disabled&&t(n.id),disabled:n.disabled,className:`
                  relative flex items-center ${m[p]}
                  font-medium transition-colors duration-200
                  ${o?"flex-1 justify-center":""}
                  ${n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                  ${g===n.id?"text-purple-400":"text-gray-400 hover:text-white"}
                `,children:[n.icon,n.label,g===n.id&&e.jsx(se.div,{layoutId:"underline",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-purple-500"})]},n.id))});default:return e.jsx("div",{className:`
              flex bg-gray-800 rounded-lg p-1
              ${o?"w-full":"inline-flex"}
              ${h}
            `,children:s.map(n=>e.jsxs("button",{onClick:()=>!n.disabled&&t(n.id),disabled:n.disabled,className:`
                  relative flex items-center ${m[p]} rounded-md
                  font-medium transition-all duration-200
                  ${o?"flex-1 justify-center":""}
                  ${n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                  ${g===n.id?"text-white":"text-gray-400 hover:text-white"}
                `,children:[g===n.id&&e.jsx(se.div,{layoutId:"activeTab",className:"absolute inset-0 bg-gray-700 rounded-md",transition:{type:"spring",stiffness:500,damping:30}}),e.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[n.icon,n.label]})]},n.id))})}})()};async function hs(s,g){const{text:t,fontSize:r=26,fontFamily:p="'Noto Sans KR', 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif",maxWidth:o=400,bubbleStyle:h="normal"}=g;return t.trim()?new Promise((m,S)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{const y=document.createElement("canvas").getContext("2d");if(!y){S(new Error("Canvas context not available"));return}y.font=`bold ${r}px ${p}`;const be=us(y,t,o),oe=r*1.5,Ce=be.length*oe,B=20,H=Ce+B*2,U=document.createElement("canvas"),b=U.getContext("2d");if(!b){S(new Error("Canvas context not available"));return}U.width=n.width,U.height=n.height+H,b.fillStyle="#ffffff",b.fillRect(0,0,U.width,H),b.strokeStyle="#e0e0e0",b.lineWidth=1,b.beginPath(),b.moveTo(0,H),b.lineTo(U.width,H),b.stroke(),b.drawImage(n,0,H),b.font=`bold ${r}px ${p}`,b.textAlign="center",b.textBaseline="top",h==="shout"?b.fillStyle="#d32f2f":h==="thought"?b.fillStyle="#666666":b.fillStyle="#1a1a1a";const re=B;be.forEach((me,i)=>{b.fillText(me,U.width/2,re+i*oe)}),m(U.toDataURL("image/png"))},n.onerror=()=>{S(new Error("Failed to load image"))},n.src=s}):s}function us(s,g,t){const r=[],p=g.split(/(\s+)/);let o="";for(const h of p){if(!h)continue;const m=o+h;if(s.measureText(m).width>t&&o.length>0){if(r.push(o.trim()),o=h,s.measureText(h).width>t){const n=h.split("");o="";for(const f of n){const y=o+f;s.measureText(y).width>t&&o.length>0?(r.push(o),o=f):o=y}}}else o=m}return o.trim()&&r.push(o.trim()),r}const ps=[{value:"full",label:"ì „ì²´"},{value:"large",label:"ëŒ€í˜•"},{value:"medium",label:"ì¤‘í˜•"},{value:"small",label:"ì†Œí˜•"},{value:"wide",label:"ê°€ë¡œí˜•"},{value:"tall",label:"ì„¸ë¡œí˜•"}],xs=[{value:"close-up",label:"í´ë¡œì¦ˆì—…"},{value:"medium-shot",label:"ë¯¸ë””ì—„ìƒ·"},{value:"wide-shot",label:"ì™€ì´ë“œìƒ·"},{value:"extreme-close-up",label:"ìµìŠ¤íŠ¸ë¦¼ í´ë¡œì¦ˆì—…"},{value:"bird-eye",label:"ë²„ë“œì•„ì´"},{value:"worm-eye",label:"ì›œì•„ì´"},{value:"dutch-angle",label:"ë”ì¹˜ì•µê¸€"},{value:"over-shoulder",label:"ì˜¤ë²„ìˆ„ë”"},{value:"pov",label:"POV"}],fs=({panel:s,episodeId:g,onUpdate:t})=>{var U,b,re,me;const[r,p]=ie.useState(!1),[o,h]=ie.useState(null),[m,S]=ie.useState(""),{currentProject:n}=ss(),{addToast:f}=Ze(),y=async(i="preview")=>{var E,ge,Le,De,Re,$e,Oe,Me,he,ve,we,ze,Be,a,w,j;if(n){p(!0);try{const C=n.episodes.find(k=>k.panels.some(c=>c.id===s.id)),J=(C==null?void 0:C.panels.findIndex(k=>k.id===s.id))??-1;let je="",ue={};if(C&&J>0){const k=Math.max(0,J-10),c=C.panels.slice(k,J);if(c.forEach(A=>{A.characters.forEach(K=>{const Z=n.characters.find(N=>N.name===K.characterName||N.koreanName===K.characterName);if(Z&&!ue[Z.name]){const N=Z.appearance||{},L=N.distinguishingFeatures||[],u=N.hairColor||"black",Y=N.hairStyle||"",pe=N.eyeColor||"dark brown",xe=N.eyeShape||"",He=N.skinTone||"fair",Ie=N.faceShape||"",Te=N.bodyType||"",fe=N.height||"",Fe=L.some(T=>/ì•ˆê²½|glasses|çœ¼é¡/i.test(T)),Ye=L.some(T=>/ì |mole|beauty mark/i.test(T)),ye=L.some(T=>/í‰í„°|scar|ìƒì²˜/i.test(T)),We=L.some(T=>/ë¬¸ì‹ |tattoo/i.test(T)),qe=L.some(T=>/í”¼ì–´ì‹±|piercing|ê·€ê±¸ì´|earring/i.test(T)),Ue=L.some(T=>/ì•ë¨¸ë¦¬|bangs|fringe/i.test(T)),Je=L.some(T=>/ìˆ˜ì—¼|beard|mustache/i.test(T));let ee="";/ë¬¶|ponytail|bun|tied|updo|ì˜¬ë¦°|twintail|íŠ¸ìœˆ/i.test(Y)?ee="TIED/PONYTAIL":/ë‹¨ë°œ|short|bob|ìˆ|pixie/i.test(Y)?ee="SHORT":/ííŠ¸ëŸ¬|messy|disheveled|unkempt|í—í´/i.test(Y)?ee="MESSY":/ê¸´|long|ë¡±|waist|í—ˆë¦¬/i.test(Y)?ee="LONG":/ì›¨ì´ë¸Œ|wave|curly|ê³±ìŠ¬/i.test(Y)?ee="WAVY/CURLY":/ìŠ¤íŠ¸ë ˆì´íŠ¸|straight|ìƒë¨¸ë¦¬/i.test(Y)&&(ee="STRAIGHT");let W=`${u} ${Y} hair`;ee&&(W+=` [${ee}]`),W+=`, ${pe} eyes`,xe&&(W+=` (${xe})`),W+=`, ${He} skin`,Ie&&(W+=`, ${Ie} face`),Te&&(W+=`, ${Te} build`),fe&&(W+=`, ${fe}`);const q=[];Fe&&q.push("GLASSES"),Ye&&q.push("MOLE/BEAUTY MARK"),ye&&q.push("SCAR"),We&&q.push("TATTOO"),qe&&q.push("PIERCING/EARRINGS"),Ue&&q.push("BANGS"),Je&&q.push("BEARD/MUSTACHE"),q.length>0&&(W+=` | MUST HAVE: ${q.join(", ")}`);const Ae=L.filter(T=>!/ì•ˆê²½|glasses|ì |mole|í‰í„°|scar|ë¬¸ì‹ |tattoo|í”¼ì–´ì‹±|piercing|ê·€ê±¸ì´|earring|ì•ë¨¸ë¦¬|bangs|ìˆ˜ì—¼|beard/i.test(T));Ae.length>0&&(W+=` | Other: ${Ae.join(", ")}`),ue[Z.name]=W}})}),c.length>0){const A=Object.entries(ue).map(([N,L])=>`â€¢ ${N}: ${L}`).join(`
`),K=c.slice(-3),Z=K.map((N,L)=>{var pe;const u=J-(K.length-L),Y=N.characters.map(xe=>xe.characterName).join(", ");return`Panel ${u}: ${((pe=N.composition)==null?void 0:pe.slice(0,80))||"no description"} [${Y}]`}).join(`
`);je=`

â•â•â• CHARACTER CONSISTENCY REFERENCE (from previous 10 panels) â•â•â•
${A}

RECENT SCENE CONTEXT:
${Z}

âš ï¸ CRITICAL CONSISTENCY RULES:
1. HAIR: Same color, length, and style (tied/loose/short/long) - NO changes
2. FACE: Same shape, skin tone, eye color and shape - NO changes
3. ACCESSORIES: Glasses, earrings, piercings - MUST remain if character has them
4. FEATURES: Moles, scars, tattoos, bangs, beard - MUST be consistent
5. BODY: Same height and build - NO changes
DO NOT modify ANY character appearance between panels!`}}const _=s.composition||((E=s.background)==null?void 0:E.description)||"",Q=n.worldBuilding,R=(Q==null?void 0:Q.era)||"",z=(Q==null?void 0:Q.setting)||"",d=/í˜„ëŒ€|modern|ì‚¬ë¬´ì‹¤|office|ì•„íŒŒíŠ¸|apartment|ë„ì‹œ|city|ìŠ¤ë§ˆíŠ¸í°|ì»´í“¨í„°|ë…¸íŠ¸ë¶|ë¹Œë”©|building|í•™êµ|school|ì¹´í˜|cafe|ë²„ìŠ¤|bus|ì§€í•˜ì² |subway|ë³‘ì›|hospital/i.test(_),V=/ê³ ëŒ€|ancient|ê³ êµ¬ë ¤|ì‚¼êµ­|ì¡°ì„ |ê³ ë ¤|í•œë³µ|ì „í†µ|ê¶ê¶|palace|ì„±ê³½|castle|ì´ˆê°€|ì›€ë§‰|í•œì˜¥|hanok/i.test(_),te=/í˜„ëŒ€|modern|ì‚¬ë¬´ì‹¤|office|ì•„íŒŒíŠ¸|apartment|ë„ì‹œ|city|ìŠ¤ë§ˆíŠ¸í°|ì»´í“¨í„°|ë…¸íŠ¸ë¶/i.test(m),O=/ê³ ëŒ€|ancient|ê³ êµ¬ë ¤|ì‚¼êµ­|ì¡°ì„ |ê³ ë ¤|í•œë³µ|ì „í†µ/i.test(m);let l="",x="",v=!1;d?(l="modern contemporary Korean setting, current day Seoul, modern buildings, urban environment",x="modern Korean fashion, casual modern clothing",v=!1,console.log("[PanelEditor] Scene description requests modern setting - highest priority")):V?(l="ancient Korean historical setting, traditional architecture",x="traditional Korean hanbok",v=!0,console.log("[PanelEditor] Scene description requests ancient setting - highest priority")):te?(l="modern contemporary Korean setting, current day Seoul, modern buildings, urban environment",x="modern Korean fashion, casual modern clothing",v=!1,console.log("[PanelEditor] Feedback requests modern setting - overriding worldbuilding")):O?(l="ancient Korean historical setting, traditional architecture",x="traditional Korean hanbok",v=!0,console.log("[PanelEditor] Feedback requests ancient setting")):R.includes("ì² ê¸°")||R.includes("ê³ êµ¬ë ¤")||R.includes("ancient")||R.includes("ì‚¼êµ­")||z.includes("ì² ê¸°")||z.includes("ê³ êµ¬ë ¤")||z.includes("ì‚¼êµ­")?(l="ancient Korean Three Kingdoms period, traditional hanok architecture, wooden structures",x="ancient Korean hanbok, layered silk robes, traditional hair accessories",v=!0,console.log("[PanelEditor] Using worldbuilding era setting (ancient)")):R.includes("ì¡°ì„ ")||z.includes("ì¡°ì„ ")?(l="Joseon Dynasty Korea, traditional hanok, paper windows",x="Joseon era hanbok",v=!0,console.log("[PanelEditor] Using worldbuilding era setting (Joseon)")):R.includes("ê³ ë ¤")||z.includes("ê³ ë ¤")?(l="Goryeo Dynasty Korea, Buddhist temples, traditional architecture",x="Goryeo era traditional clothing",v=!0,console.log("[PanelEditor] Using worldbuilding era setting (Goryeo)")):(R.includes("í˜„ëŒ€")||R.includes("modern")||z.includes("í˜„ëŒ€"))&&(l="modern contemporary Korean setting, current day",x="modern Korean fashion",v=!1,console.log("[PanelEditor] Using worldbuilding era setting (modern)"));const P=v?`

CRITICAL ERA CONSISTENCY: This is a HISTORICAL setting. ABSOLUTELY NO modern elements allowed - no modern buildings, no electricity, no modern clothing, no glasses, no modern hairstyles. Everything must be period-accurate.`:"",$=s.characters.map(k=>{var A,K,Z,N,L,u,Y,pe,xe,He,Ie,Te;const c=n.characters.find(fe=>fe.name===k.characterName||fe.koreanName===k.characterName);if(c){const fe=c.gender==="female"?"beautiful young Korean woman":c.gender==="male"?"handsome young Korean man":"Korean person",Fe=c.age||25,Ye=((A=c.appearance)==null?void 0:A.hairColor)||"black",ye=((K=c.appearance)==null?void 0:K.hairStyle)||"long",We=((Z=c.appearance)==null?void 0:Z.eyeColor)||"dark brown",qe=((N=c.appearance)==null?void 0:N.bodyType)||"slim",Ue=((L=c.appearance)==null?void 0:L.height)||"",Je=((u=c.appearance)==null?void 0:u.skinTone)||"fair",ee=((Y=c.appearance)==null?void 0:Y.faceShape)||"oval",W=((pe=c.appearance)==null?void 0:pe.eyeShape)||"almond",q=((He=(xe=c.appearance)==null?void 0:xe.distinguishingFeatures)==null?void 0:He.join(", "))||"",Ae=((Ie=c.appearance)==null?void 0:Ie.defaultOutfit)||"",T=Ae||x||(v?"traditional Korean hanbok":"modern Korean clothing"),os=c.role==="protagonist"?`elegant ${T}, high quality fabric`:c.role==="antagonist"?`imposing ${T}, dark tones`:T,rs=(((Te=c.appearance)==null?void 0:Te.distinguishingFeatures)||[]).some(ls=>/ì•ˆê²½|glasses/i.test(ls))?", MUST BE WEARING GLASSES":"";let Pe="";return/ë¬¶|ponytail|bun|tied|updo|ì˜¬ë¦°/i.test(ye)?Pe=" (HAIR TIED UP/PONYTAIL - NOT loose)":/ë‹¨ë°œ|short|bob|ìˆ/i.test(ye)?Pe=" (SHORT HAIR - above shoulders)":/ííŠ¸ëŸ¬|messy|disheveled|unkempt|í—í´/i.test(ye)?Pe=" (MESSY/DISHEVELED hair)":/ê¸´|long|ë¡±/i.test(ye)&&(Pe=" (LONG flowing hair)"),`[CHARACTER: ${c.name}] ${fe}, exactly ${Fe} years old, MUST have ${Ye} ${ye} hair${Pe}, ${We} ${W} eyes${rs}, ${Je} skin, ${ee} face, ${qe} body${Ue?`, ${Ue}`:""}, wearing ${os}${q?`. Distinctive features: ${q}`:""}. CRITICAL: Keep this character's face, hairstyle, and accessories (especially glasses) EXACTLY consistent with reference image provided.`}return v?"Korean person in traditional hanbok, period-accurate clothing":"Korean person in modern clothing"}).join(`
`),M=((Le=(ge=s.dialogues)==null?void 0:ge[0])==null?void 0:Le.text)||"",I=s.mood||"peaceful",G=s.lighting||"natural",F=s.size||"medium",ae=s.cameraAngle||"medium-shot",le={natural:"bright natural daylight, clear illumination",sunset:"warm golden hour lighting, orange and pink tones",night:"dark nighttime atmosphere with moonlight, blue shadows",indoor:"soft indoor artificial lighting, warm ambient",dramatic:"high contrast dramatic lighting, deep shadows, strong highlights",soft:"soft diffused lighting, gentle shadows",backlight:"strong backlight creating silhouette effect, rim lighting",neon:"colorful neon glow, cyberpunk atmosphere"},Ne={happy:"bright cheerful atmosphere, warm colors",sad:"melancholic mood, muted colors, somber tone",angry:"intense aggressive mood, sharp contrasts",romantic:"soft romantic atmosphere, warm pink tones",tense:"suspenseful tension, dramatic shadows",mysterious:"enigmatic mysterious mood, dark atmosphere",comedic:"light humorous tone, exaggerated expressions",peaceful:"calm serene atmosphere, gentle lighting",dramatic:"intense dramatic mood, high contrast",nostalgic:"warm nostalgic feeling, sepia tones"},ce={"close-up":"close-up shot focusing on face and expression","extreme-close-up":"extreme close-up on eyes or specific detail","medium-shot":"medium shot showing upper body","wide-shot":"wide establishing shot showing full scene with background","bird-eye":"bird's eye view from above looking down","worm-eye":"low angle worm's eye view looking up","dutch-angle":"tilted dutch angle creating unease","over-shoulder":"over the shoulder perspective",pov:"first person point of view"},de=le[G]||"natural lighting",ke=Ne[I]||"neutral atmosphere",X=ce[ae]||"medium shot",Se=m?`

**CRITICAL USER FEEDBACK (MUST APPLY)**: ${m}
This feedback overrides any conflicting settings above.`:"",Ee=`Webtoon illustration, Korean manhwa style, clean detailed lineart, cel-shading, professional quality.

ğŸš«ğŸš«ğŸš« CRITICAL - NO TEXT ALLOWED ğŸš«ğŸš«ğŸš«
DO NOT draw ANY text, letters, words, speech bubbles, captions, signs, or Korean/English/Japanese characters.
NO í•œê¸€, NO hangul, NO writing of any kind. The image must be COMPLETELY TEXT-FREE.
Text will be added separately later. Drawing text will RUIN the image.

SCENE DESCRIPTION:
${_}

VISUAL STYLE:
- Panel type: ${F} panel
- Camera: ${X}
- Lighting: ${de}
- Mood/Atmosphere: ${ke}

${$?`CHARACTERS IN SCENE:
${$}`:""}

${l?`SETTING/ERA: ${l}`:""}
${x?`COSTUME STYLE: ${x}`:""}
${P}
${je}
${Se}

IMPORTANT: Maintain visual consistency with character appearances. Use ${X} composition. Create ${ke} with ${de}.
REMINDER: NO TEXT, NO LETTERS, NO SPEECH BUBBLES - pure illustration only.`;console.log("[PanelEditor] Generated prompt:",Ee);const ne=[];for(const k of s.characters){const c=n.characters.find(A=>A.name===k.characterName||A.koreanName===k.characterName);if(c){const A=((De=c.referenceImages)==null?void 0:De.filter(u=>u.type==="anchor"))||[];for(const u of A.slice(0,2))ne.push(u.imageData);const K=((Re=c.expressions)==null?void 0:Re.filter(u=>u.imageData))||[];for(const u of K.slice(0,1))u.imageData&&ne.push(u.imageData);const Z=(($e=c.poses)==null?void 0:$e.filter(u=>u.imageData))||[];for(const u of Z.slice(0,1))u.imageData&&ne.push(u.imageData);const N=((Oe=c.outfits)==null?void 0:Oe.filter(u=>u.imageData))||[];for(const u of N.slice(0,1))u.imageData&&ne.push(u.imageData);const L=((Me=c.referenceImages)==null?void 0:Me.filter(u=>u.type!=="anchor"))||[];for(const u of L.slice(0,1))ne.push(u.imageData)}}if((he=n.worldBuilding)!=null&&he.mainLocations){const k=((we=(ve=s.background)==null?void 0:ve.description)==null?void 0:we.toLowerCase())||"";for(const c of n.worldBuilding.mainLocations)if(k.includes(c.name.toLowerCase())){for(const A of c.variations||[])if(A.generatedImage){ne.push(A.generatedImage);break}}}if(C&&J>0){const k=Math.max(0,J-5),c=C.panels.slice(k,J);for(let A=c.length-1;A>=0;A--){const K=c[A];(ze=K.generatedImage)!=null&&ze.imageData&&ne.length<12&&ne.push(K.generatedImage.imageData)}}const is=ne.slice(0,14),Ke=await Xe.generateImage(Ee,{resolution:i,styleAnchor:"",referenceImages:is,useCache:!1});let Ge=Ke.imageData;if(M)try{const k=(a=(Be=s.dialogues)==null?void 0:Be[0])==null?void 0:a.bubbleStyle,c=k==="thought"||k==="shout"?k:"normal";Ge=await hs(Ke.imageData,{text:M,position:((j=(w=s.dialogues)==null?void 0:w[0])==null?void 0:j.position)||{x:50,y:15},fontSize:28,bubbleStyle:c})}catch(k){console.error("Speech bubble rendering failed:",k)}i==="preview"?h(Ge):(t({generatedImage:{id:Date.now().toString(),resolution:i,imageData:Ge,promptUsed:Ee,generatedAt:new Date,fromCache:Ke.fromCache,cost:Ke.cost},status:"approved"}),h(null)),f({message:i==="preview"?"í”„ë¦¬ë·°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤":"ê³ í•´ìƒë„ ì´ë¯¸ì§€ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤",type:"success"})}catch(C){console.error("Image generation failed:",C),f({message:"ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",type:"error"})}finally{p(!1)}}},be=()=>{o&&(t({generatedImage:{id:Date.now().toString(),resolution:"preview",imageData:o,promptUsed:s.visualPrompt,generatedAt:new Date,fromCache:!1,cost:.001},status:"approved"}),h(null))},oe=((b=(U=s.dialogues)==null?void 0:U[0])==null?void 0:b.text)||"",Ce={"close-up":"í´ë¡œì¦ˆì—…","extreme-close-up":"ìµìŠ¤íŠ¸ë¦¼","medium-shot":"ë¯¸ë””ì—„","wide-shot":"ì™€ì´ë“œ","bird-eye":"ë²„ë“œì•„ì´","worm-eye":"ì›œì•„ì´","dutch-angle":"ë”ì¹˜","over-shoulder":"ì˜¤ë²„ìˆ„ë”",pov:"POV"},B={happy:"ë°ìŒ",sad:"ìŠ¬í””",angry:"ë¶„ë…¸",romantic:"ë¡œë§¨í‹±",tense:"ê¸´ì¥",mysterious:"ë¯¸ìŠ¤í„°ë¦¬",comedic:"ì½”ë¯¹",peaceful:"í‰í™”",dramatic:"ê·¹ì ",nostalgic:"í–¥ìˆ˜"},H={natural:"ìì—°ê´‘",sunset:"ì„ì–‘",night:"ì•¼ê°„",indoor:"ì‹¤ë‚´",dramatic:"ê·¹ì ",soft:"ì†Œí”„íŠ¸",backlight:"ì—­ê´‘",neon:"ë„¤ì˜¨"};return e.jsxs("div",{className:"bg-gray-800/50 rounded-xl border border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xl font-bold text-purple-400",children:["#",s.panelNumber]}),((me=(re=s.characters)==null?void 0:re[0])==null?void 0:me.characterName)&&e.jsx("span",{className:"text-sm text-gray-300",children:s.characters[0].characterName}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-400 text-xs rounded-full",children:Ce[s.cameraAngle]||s.cameraAngle}),s.mood&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-500/20 text-purple-400 text-xs rounded-full",children:B[s.mood]||s.mood}),s.lighting&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-400 text-xs rounded-full",children:H[s.lighting]||s.lighting})]})]}),e.jsx(_e,{options:ps,value:s.size,onChange:i=>t({size:i}),placeholder:"í¬ê¸°"})]}),e.jsxs("div",{className:"p-4",children:[oe&&e.jsxs("div",{className:"mb-4 p-3 bg-white/10 rounded-lg border-l-4 border-purple-500",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"ğŸ’¬ ëŒ€ì‚¬"}),e.jsxs("p",{className:"text-white text-lg font-medium",children:['"',oe,'"']})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"aspect-[4/3] bg-gray-900 rounded-lg overflow-hidden relative",children:e.jsx(cs,{mode:"wait",children:r?e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ts,{size:"lg",className:"mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"ì´ë¯¸ì§€ ìƒì„± ì¤‘..."})]})},"loading"):o?e.jsx(se.img,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},src:o,alt:"Preview",className:"w-full h-full object-contain bg-gray-950"},"preview"):s.generatedImage?e.jsx(se.img,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},src:s.generatedImage.imageData,alt:`Panel ${s.panelNumber}`,className:"w-full h-full object-contain bg-gray-950"},"generated"):e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-5xl mb-3 block",children:"ğŸ¨"}),e.jsx("p",{className:"text-gray-400",children:"ì´ë¯¸ì§€ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”"})]})},"empty")})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(_e,{label:"ì•µê¸€",options:xs,value:s.cameraAngle,onChange:i=>t({cameraAngle:i})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"ì¥ë©´ ì„¤ëª…"}),e.jsx("textarea",{value:s.composition,onChange:i=>t({composition:i.target.value}),rows:3,className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm resize-none",placeholder:"ì¥ë©´ ì„¤ëª…..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"ëŒ€ì‚¬ ìˆ˜ì •"}),e.jsx("textarea",{value:oe,onChange:i=>{var ge;const E=(ge=s.dialogues)!=null&&ge.length?[{...s.dialogues[0],text:i.target.value}]:[{id:`dlg-${Date.now()}`,text:i.target.value,type:"speech",bubbleStyle:"normal",position:{x:50,y:20},size:{width:200,height:80},fontSize:"medium"}];t({dialogues:E})},rows:2,className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm resize-none",placeholder:"ìºë¦­í„° ëŒ€ì‚¬..."})]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-700/50 rounded-lg",children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"âœï¸ ê·¸ë¦¼ ë³´ì™„ì  (ì¬ìƒì„± ì‹œ ë°˜ì˜)"}),e.jsx("textarea",{value:m,onChange:i=>S(i.target.value),rows:2,className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm resize-none mb-3",placeholder:"ì˜ˆ: í‘œì •ì„ ë” ë°ê²Œ, ë°°ê²½ì„ ì–´ë‘¡ê²Œ, ì•µê¸€ì„ í´ë¡œì¦ˆì—…ìœ¼ë¡œ... (ëŒ€ì‚¬ëŠ” ìœ„ 'ëŒ€ì‚¬ ìˆ˜ì •'ì— ì…ë ¥)"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(D,{variant:"primary",onClick:()=>y("preview"),disabled:r,loading:r,children:s.generatedImage||o?"ğŸ”„ ì¬ìƒì„±":"ğŸ¨ ì´ë¯¸ì§€ ìƒì„±"}),o&&e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"primary",onClick:be,size:"sm",children:"âœ“ ìŠ¹ì¸"}),e.jsx(D,{variant:"secondary",onClick:()=>h(null),size:"sm",children:"ì·¨ì†Œ"})]})]})]})]})]})},ys=({panels:s,selectedPanelId:g,onSelectPanel:t,onDeletePanel:r,onDeleteAllPanels:p})=>e.jsxs("div",{className:"bg-gray-800/50 rounded-xl border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"íƒ€ì„ë¼ì¸"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:[s.length," íŒ¨ë„"]}),s.length>0&&p&&e.jsx("button",{onClick:()=>{confirm("ëª¨ë“  íŒ¨ë„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&p()},className:"text-xs text-red-400 hover:text-red-300 px-2 py-1 rounded bg-red-500/10 hover:bg-red-500/20",children:"ì „ì²´ ì‚­ì œ"})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[s.map(o=>e.jsxs(se.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>t(o.id),className:`
              group relative flex-shrink-0 w-20 h-28 rounded-lg overflow-hidden border-2 transition-all
              ${g===o.id?"border-purple-500 ring-2 ring-purple-500/30":"border-gray-700 hover:border-gray-600"}
            `,children:[o.generatedImage?e.jsx("img",{src:o.generatedImage.imageData,alt:`Panel ${o.panelNumber}`,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-900 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 text-2xl",children:"ğŸ¨"})}),e.jsx("div",{className:"absolute top-1 left-1 w-5 h-5 rounded bg-black/60 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:o.panelNumber})}),r&&e.jsx("div",{onClick:h=>{h.stopPropagation(),confirm(`íŒ¨ë„ ${o.panelNumber}ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)&&r(o.id)},className:"absolute top-1 right-1 w-5 h-5 rounded bg-red-500/80 hover:bg-red-500 flex items-center justify-center cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs",children:"âœ•"})}),e.jsx("div",{className:`absolute bottom-1 right-1 w-2 h-2 rounded-full ${o.status==="approved"?"bg-green-500":o.status==="preview"?"bg-yellow-500":"bg-gray-500"}`}),g===o.id&&e.jsx(se.div,{layoutId:"selectedPanel",className:"absolute inset-0 border-2 border-purple-500 rounded-lg"})]},o.id)),e.jsx("button",{className:"flex-shrink-0 w-20 h-28 rounded-lg border-2 border-dashed border-gray-700 hover:border-gray-600 flex items-center justify-center transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}),bs=({projectTitle:s,episodeTitle:g,onSave:t,onPreview:r,onExport:p})=>{const{viewMode:o,setViewMode:h,zoom:m,setZoom:S}=Ze(),n=[{id:"edit",label:"í¸ì§‘"},{id:"preview",label:"ë¯¸ë¦¬ë³´ê¸°"},{id:"split",label:"ë¶„í• "}];return e.jsx("div",{className:"bg-gray-800/80 backdrop-blur-sm border-b border-gray-700 px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-white font-bold",children:s}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"text-gray-300",children:g})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(as,{tabs:n,activeTab:o,onChange:f=>h(f),variant:"pills",size:"sm"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-gray-700 rounded-lg",children:[e.jsx("button",{onClick:()=>S(m-10),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsxs("span",{className:"text-white text-sm w-12 text-center",children:[m,"%"]}),e.jsx("button",{onClick:()=>S(m+10),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:t,children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"ì €ì¥"]}),e.jsxs(D,{variant:"ghost",size:"sm",onClick:r,children:[e.jsxs("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"ë¯¸ë¦¬ë³´ê¸°"]}),e.jsxs(D,{variant:"primary",size:"sm",onClick:p,children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"ë‚´ë³´ë‚´ê¸°"]})]})]})})};async function vs(s){const t=[...s].sort((n,f)=>n.panelNumber-f.panelNumber).filter(n=>{var f;return(f=n.generatedImage)==null?void 0:f.imageData});if(t.length===0)throw new Error("ë‚´ë³´ë‚¼ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.");const r=await Promise.all(t.map(n=>ws(n.generatedImage.imageData))),p=Math.max(...r.map(n=>n.width)),o=r.reduce((n,f)=>n+f.height,0),h=document.createElement("canvas"),m=h.getContext("2d");if(!m)throw new Error("Canvas context not available");h.width=p,h.height=o,m.fillStyle="#ffffff",m.fillRect(0,0,h.width,h.height);let S=0;for(const n of r){const f=(p-n.width)/2;m.drawImage(n,f,S),S+=n.height}return h.toDataURL("image/png")}function ws(s){return new Promise((g,t)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>g(r),r.onerror=()=>t(new Error("Failed to load image")),r.src=s})}function ns(s,g){const t=document.createElement("a");t.href=s,t.download=g,document.body.appendChild(t),t.click(),document.body.removeChild(t)}async function js(s){const g=await vs(s.panels),t=`${s.episodeNumber}í™”_${s.title||"episode"}.png`;ns(g,t)}function Ns(s,g){var r;if(!((r=s.generatedImage)!=null&&r.imageData))throw new Error("ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.");const t=`${g}í™”_íŒ¨ë„${s.panelNumber}.png`;ns(s.generatedImage.imageData,t)}async function es(s){const t=[...s.panels].sort((r,p)=>r.panelNumber-p.panelNumber).filter(r=>{var p;return(p=r.generatedImage)==null?void 0:p.imageData});for(const r of t)Ns(r,s.episodeNumber),await new Promise(p=>setTimeout(p,300))}async function ks(s,g){const{format:t}=g;switch(t){case"long-image":await js(s);break;case"individual":await es(s);break;case"zip":await es(s);break;default:throw new Error("ì§€ì›í•˜ì§€ ì•ŠëŠ” ë‚´ë³´ë‚´ê¸° í˜•ì‹ì…ë‹ˆë‹¤.")}}const Rs=()=>{const{projectId:s}=ds(),g=ms(),{currentProject:t,setCurrentProject:r,updatePanel:p,addPanel:o,deletePanel:h}=ss(),{selectedEpisodeId:m,setSelectedEpisode:S,selectedPanelId:n,setSelectedPanel:f,addToast:y}=Ze(),{user:be}=gs(),[oe,Ce]=ie.useState(!0),[B,H]=ie.useState(!1),[U,b]=ie.useState(!1),[re,me]=ie.useState([]);ie.useEffect(()=>{(async()=>{s&&(await r(s),Ce(!1))})()},[s,r]),ie.useEffect(()=>{t!=null&&t.episodes.length&&!m&&S(t.episodes[0].id)},[t,m,S]);const i=t==null?void 0:t.episodes.find(a=>a.id===m),E=i==null?void 0:i.panels.find(a=>a.id===n),ge=async(a,w)=>{m&&(await p(m,a,w),y({message:"íŒ¨ë„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤",type:"success"}))},Le=async()=>{var a,w;if(!(!i||!t)){H(!0),y({message:"íŒ¨ë„ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...",type:"info"});try{const j=t.worldBuilding,C=(j==null?void 0:j.era)||"ê³ ëŒ€ í•œêµ­",J=(j==null?void 0:j.setting)||"ì—­ì‚¬ë¬¼",je=t.characters.map(d=>{var P,$,M,I,G,F;const V=d.gender==="female"?"woman":d.gender==="male"?"man":"person",te=((P=d.appearance)==null?void 0:P.hairColor)||"black",O=(($=d.appearance)==null?void 0:$.hairStyle)||"long",l=((M=d.appearance)==null?void 0:M.eyeColor)||"dark brown",x=((I=d.appearance)==null?void 0:I.defaultOutfit)||"",v=((F=(G=d.appearance)==null?void 0:G.distinguishingFeatures)==null?void 0:F.join(", "))||"";return`${d.name}: ${V}, ${te} ${O} hair, ${l} eyes${x?`, wearing ${x}`:""}${v?`, features: ${v}`:""}`}).join(`
`),ue=((a=j==null?void 0:j.mainLocations)==null?void 0:a.map(d=>`${d.name}: ${d.description||""}`).join(`
`))||"",_=70,Q=`ì›¹íˆ° ${i.episodeNumber}í™” íŒ¨ë„ ${_}ê°œ ìƒì„±. JSON ì¶œë ¥.

ìŠ¤í† ë¦¬: ${i.summary}
ë°°ê²½: ${C}, ${J}
ì£¼ìš” ì´ë²¤íŠ¸: ${((w=i.keyEvents)==null?void 0:w.join(", "))||""}

ìºë¦­í„°:
${je}

ì¥ì†Œ:
${ue}

âš ï¸âš ï¸âš ï¸ ë§¤ìš° ì¤‘ìš” - ë°˜ë“œì‹œ ì´ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥ âš ï¸âš ï¸âš ï¸

{"panels":[
{"n":1,"size":"full","camera":"wide-shot","mood":"mysterious","lighting":"night","img":"[LOCATION: ì–´ë‘ìš´ ì‚¬ë¬´ì‹¤, ëª¨ë‹ˆí„° ë¶ˆë¹›ë§Œ ë¹„ì¹¨] [CHARACTER: í•˜ëŠ˜, 20ëŒ€ ì—¬ì„±, ê²€ì€ ê¸´ ë¨¸ë¦¬ ííŠ¸ëŸ¬ì§, ë‹¤í¬ì„œí´, í›„ë“œí‹°] [ATMOSPHERE: ìƒˆë²½ 3ì‹œ, ì°¨ê°€ìš´ ëª¨ë‹ˆí„° ë¹›]","dialog":""},
{"n":2,"size":"small","camera":"extreme-close-up","mood":"tense","lighting":"dramatic","img":"[FOCUS: ë””ì§€í„¸ ì‹œê³„ 03:42 AM]","dialog":""},
{"n":3,"size":"medium","camera":"medium-shot","mood":"sad","lighting":"indoor","img":"[CHARACTER: í•˜ëŠ˜, ì§€ì¹œ í‘œì •ìœ¼ë¡œ í‚¤ë³´ë“œ íƒ€ì´í•‘]","dialog":"ì  ì¥..."}
]}

ğŸ“Œ ê° íŒ¨ë„ì— ë°˜ë“œì‹œ í¬í•¨í•  6ê°œ í•„ë“œ:
- "n": íŒ¨ë„ ë²ˆí˜¸ (1-${_})
- "size": full/large/medium/small/wide ì¤‘ í•˜ë‚˜
- "camera": close-up/extreme-close-up/medium-shot/wide-shot/bird-eye/worm-eye/dutch-angle/over-shoulder ì¤‘ í•˜ë‚˜
- "mood": happy/sad/angry/romantic/tense/mysterious/comedic/peaceful/dramatic/nostalgic ì¤‘ í•˜ë‚˜
- "lighting": natural/sunset/night/indoor/dramatic/soft/backlight/neon ì¤‘ í•˜ë‚˜
- "img": ì˜ì–´ë¡œ ìƒì„¸í•œ ì¥ë©´ ì„¤ëª…
- "dialog": í•œêµ­ì–´ ëŒ€ì‚¬ ë˜ëŠ” ""

ğŸ“Š ë‹¤ì–‘í•˜ê²Œ ì‚¬ìš©í•´ì•¼ í•  ë¹„ìœ¨:
- size: full 10ê°œ, large 15ê°œ, medium 30ê°œ, small 15ê°œ
- camera: ë‹¤ì–‘í•œ ì•µê¸€ì„ ì”¬ì— ë§ê²Œ ì‚¬ìš©
- mood: ì¥ë©´ ê°ì •ì— ë§ê²Œ ë³€ê²½
- lighting: ì‹œê°„ëŒ€ì™€ ë¶„ìœ„ê¸°ì— ë§ê²Œ ë³€ê²½

ğŸ¨ img í•„ë“œ ì‘ì„±ë²• (ì˜ì–´ë¡œ):
[LOCATION: ì¥ì†Œ ìƒì„¸ - ê±´ë¬¼, ê°€êµ¬, ì†Œí’ˆ]
[CHARACTER: ì´ë¦„, ì„±ë³„, ë‚˜ì´, ë¨¸ë¦¬ìƒ‰+ìŠ¤íƒ€ì¼, ëˆˆìƒ‰, í‘œì •, í¬ì¦ˆ, ì˜ìƒ ìƒì„¸]
[ATMOSPHERE: ì¡°ëª… ë°©í–¥, ê·¸ë¦¼ì, ë‚ ì”¨]

ê·œì¹™:
1. ì •í™•íˆ ${_}ê°œ íŒ¨ë„ ìƒì„± (1-${_})
2. ëª¨ë“  íŒ¨ë„ì— size, camera, mood, lighting í•„ë“œ í•„ìˆ˜!
3. imgëŠ” ì˜ì–´ë¡œë§Œ, dialogëŠ” í•œêµ­ì–´ë¡œë§Œ
4. ëŒ€ì‚¬ ì—†ëŠ” ì¥ë©´ì€ dialogë¥¼ "" ë¡œ
5. JSONë§Œ ì¶œë ¥, { ë¡œ ì‹œì‘`,R=await Xe.generateText(Q,{temperature:.8,maxTokens:32e3,useCache:!1});console.log("[AI Response Raw]:",R);const z=Qe(R);if(console.log("[Parsed Result]:",JSON.stringify(z,null,2)),!z.panels||z.panels.length===0)throw new Error("íŒ¨ë„ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");for(const d of z.panels){console.log("[Panel Data]:",JSON.stringify(d,null,2));const V=d.n||d.panelNumber||1,te=d.img||d.sceneDescription||"";let O=d.dialog??d.dialogue??d.talk??d.speech??d.text??"";console.log(`[Panel ${V}] Dialog field:`,d.dialog,"| Dialogue field:",d.dialogue,"| Final:",O);const x=!/[ê°€-í£]/.test(O)&&/^[a-zA-Z\s,.\-'":;!?]+$/.test(O);O&&x&&(console.log(`[Panel ${V}] Filtered out English description:`,O),O="");const v=d.who||d.character||"",P=d.size||"medium",$=d.camera||"medium-shot",M=d.mood||"peaceful",I=d.lighting||"natural";console.log(`[Panel ${V}] AI Values - size: ${d.size}, camera: ${d.camera}, mood: ${d.mood}, lighting: ${d.lighting}`);const G=["full","large","medium","small","wide","tall"],F=["close-up","medium-shot","wide-shot","extreme-close-up","bird-eye","worm-eye","dutch-angle","over-shoulder","pov"],ae=["happy","sad","angry","romantic","tense","mysterious","comedic","peaceful","dramatic","nostalgic"],le=["natural","sunset","night","indoor","dramatic","soft","backlight","neon"],Ne=G.includes(P)?P:"medium",ce=F.includes($)?$:"medium-shot",de=ae.includes(M)?M:"peaceful",ke=le.includes(I)?I:"natural";let X="afternoon";I==="night"?X="night":I==="sunset"?X="evening":I==="soft"&&(X="morning");const Se={episodeId:i.id,panelNumber:V,size:Ne,cameraAngle:ce,composition:te,characters:v?[{characterId:"",characterName:v,position:{x:50,y:50},scale:1,expression:"neutral",pose:"standing",action:"",facing:"front",layer:1}]:[],background:{locationName:"",description:te,timeOfDay:X,weather:"",mood:de,focusPoint:"",depth:Ne==="wide"||ce==="wide-shot"?"deep":ce==="close-up"||ce==="extreme-close-up"?"shallow":"medium"},dialogues:O?[{id:`dlg-${Date.now()}-${V}`,text:O,type:"speech",bubbleStyle:"normal",position:{x:50,y:20},size:{width:200,height:80},fontSize:"medium"}]:[],sfx:[],mood:de,lighting:ke,visualPrompt:te,status:"pending"};await o(i.id,Se)}await r(s),y({message:`${z.panels.length}ê°œ íŒ¨ë„ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`,type:"success"})}catch(j){console.error("Panel generation failed:",j),y({message:"íŒ¨ë„ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",type:"error"})}finally{H(!1)}}},De=async a=>{m&&(await h(m,a),f(null),y({message:"íŒ¨ë„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤",type:"success"}))},Re=async()=>{if(i){for(const a of i.panels)await h(i.id,a.id);f(null),y({message:"ëª¨ë“  íŒ¨ë„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤",type:"success"})}},$e=()=>{if(!i)return[];const a=70,w=new Set(i.panels.map(C=>C.panelNumber)),j=[];for(let C=1;C<=a;C++)w.has(C)||j.push(C);return j},Oe=()=>{const a=$e();a.length>0?(me(a),b(!0)):y({message:"ë¹ ì§„ íŒ¨ë„ì´ ì—†ìŠµë‹ˆë‹¤!",type:"success"})},Me=async a=>{if(!(!i||!t||a.length===0)){H(!0),b(!1),y({message:`${a.length}ê°œ ë¹ ì§„ íŒ¨ë„ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...`,type:"info"});try{const w=t.worldBuilding,j=(w==null?void 0:w.era)||"ê³ ëŒ€ í•œêµ­",C=(w==null?void 0:w.setting)||"ì—­ì‚¬ë¬¼",J=t.characters.map(l=>{var I,G,F,ae;const x=l.gender==="female"?"woman":l.gender==="male"?"man":"person",v=((I=l.appearance)==null?void 0:I.hairColor)||"black",P=((G=l.appearance)==null?void 0:G.hairStyle)||"long",$=((F=l.appearance)==null?void 0:F.eyeColor)||"dark brown",M=((ae=l.appearance)==null?void 0:ae.defaultOutfit)||"";return`${l.name}: ${x}, ${v} ${P} hair, ${$} eyes${M?`, wearing ${M}`:""}`}).join(`
`),je=l=>{var $,M;const x=i.panels.find(I=>I.panelNumber===l-1),v=i.panels.find(I=>I.panelNumber===l+1);let P="";return x&&(P+=`Previous panel ${l-1}: ${(($=x.composition)==null?void 0:$.slice(0,100))||"no description"}
`),v&&(P+=`Next panel ${l+1}: ${((M=v.composition)==null?void 0:M.slice(0,100))||"no description"}
`),P},ue=a.map(l=>`Panel ${l} context:
${je(l)}`).join(`

`),_=`ë¹ ì§„ íŒ¨ë„ë§Œ ìƒì„±. JSON ì¶œë ¥.

ìŠ¤í† ë¦¬: ${i.summary}
ë°°ê²½: ${j}, ${C}

ìºë¦­í„°:
${J}

ìƒì„±í•  íŒ¨ë„ ë²ˆí˜¸: ${a.join(", ")}

ì•ë’¤ ë¬¸ë§¥:
${ue}

âš ï¸âš ï¸âš ï¸ ë°˜ë“œì‹œ ì´ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥ âš ï¸âš ï¸âš ï¸

{"panels":[
{"n":${a[0]},"size":"medium","camera":"close-up","mood":"tense","lighting":"dramatic","img":"[LOCATION: ì¥ì†Œ] [CHARACTER: ì´ë¦„, ë¨¸ë¦¬ìƒ‰, í‘œì •, ì˜ìƒ] [ATMOSPHERE: ì¡°ëª…]","dialog":"í•œêµ­ì–´ ëŒ€ì‚¬"}
]}

ğŸ“Œ ê° íŒ¨ë„ì— ë°˜ë“œì‹œ í¬í•¨í•  6ê°œ í•„ë“œ:
- "n": íŒ¨ë„ ë²ˆí˜¸
- "size": full/large/medium/small/wide ì¤‘ í•˜ë‚˜
- "camera": close-up/extreme-close-up/medium-shot/wide-shot/bird-eye/worm-eye/dutch-angle/over-shoulder ì¤‘ í•˜ë‚˜
- "mood": happy/sad/angry/romantic/tense/mysterious/comedic/peaceful/dramatic/nostalgic ì¤‘ í•˜ë‚˜
- "lighting": natural/sunset/night/indoor/dramatic/soft/backlight/neon ì¤‘ í•˜ë‚˜
- "img": ì˜ì–´ë¡œ ì¥ë©´ ì„¤ëª…
- "dialog": í•œêµ­ì–´ ëŒ€ì‚¬ ë˜ëŠ” ""

ê·œì¹™:
1. ì •í™•íˆ ${a.join(", ")} ë²ˆ íŒ¨ë„ë§Œ ìƒì„± (${a.length}ê°œ)
2. ëª¨ë“  íŒ¨ë„ì— size, camera, mood, lighting í•„ë“œ í•„ìˆ˜!
3. ì•ë’¤ íŒ¨ë„ê³¼ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°
4. JSONë§Œ ì¶œë ¥`,Q=await Xe.generateText(_,{temperature:.7,maxTokens:16e3,useCache:!1}),R=Qe(Q);if(!R.panels||R.panels.length===0)throw new Error("íŒ¨ë„ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");const z=["full","large","medium","small","wide","tall"],d=["close-up","medium-shot","wide-shot","extreme-close-up","bird-eye","worm-eye","dutch-angle","over-shoulder","pov"],V=["happy","sad","angry","romantic","tense","mysterious","comedic","peaceful","dramatic","nostalgic"],te=["natural","sunset","night","indoor","dramatic","soft","backlight","neon"];let O=0;for(const l of R.panels){const x=l.n||l.panelNumber;if(!a.includes(x)){console.log(`[Missing Panel] Skipping panel ${x} - not in requested list`);continue}if(i.panels.some(Ee=>Ee.panelNumber===x)){console.log(`[Missing Panel] Panel ${x} already exists, skipping`);continue}const P=l.img||l.sceneDescription||"";let $=l.dialog??l.dialogue??"";const I=!/[ê°€-í£]/.test($)&&/^[a-zA-Z\s,.\-'":;!?]+$/.test($);$&&I&&($="");const G=l.size||"medium",F=l.camera||"medium-shot",ae=l.mood||"peaceful",le=l.lighting||"natural",Ne=z.includes(G)?G:"medium",ce=d.includes(F)?F:"medium-shot",de=V.includes(ae)?ae:"peaceful",ke=te.includes(le)?le:"natural";let X="afternoon";le==="night"?X="night":le==="sunset"&&(X="evening");const Se={episodeId:i.id,panelNumber:x,size:Ne,cameraAngle:ce,composition:P,characters:[],background:{locationName:"",description:P,timeOfDay:X,weather:"",mood:de,focusPoint:"",depth:"medium"},dialogues:$?[{id:`dlg-${Date.now()}-${x}`,text:$,type:"speech",bubbleStyle:"normal",position:{x:50,y:20},size:{width:200,height:80},fontSize:"medium"}]:[],sfx:[],mood:de,lighting:ke,visualPrompt:P,status:"pending"};await o(i.id,Se),O++}await r(s),y({message:`${O}ê°œ ë¹ ì§„ íŒ¨ë„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`,type:"success"})}catch(w){console.error("Missing panel generation failed:",w),y({message:"ë¹ ì§„ íŒ¨ë„ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",type:"error"})}finally{H(!1)}}};if(oe)return e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsx(ts,{size:"lg"})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsxs(Ve,{className:"text-center p-8",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),e.jsx(D,{variant:"primary",onClick:()=>g("/dashboard"),children:"ëŒ€ì‹œë³´ë“œë¡œ ì´ë™"})]})});const he=(t==null?void 0:t.episodes.findIndex(a=>a.id===m))??-1,ve=he>0,we=he<((t==null?void 0:t.episodes.length)??0)-1,ze=()=>{if(ve&&t){const a=t.episodes[he-1];S(a.id),a.panels.length>0?f(a.panels[0].id):f(null)}},Be=()=>{if(we&&t){const a=t.episodes[he+1];S(a.id),a.panels.length>0?f(a.panels[0].id):f(null)}};return e.jsxs("div",{className:"min-h-screen bg-gray-900 flex flex-col",children:[e.jsxs("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>g(`/create/${s}`),className:"text-gray-400 hover:text-white",children:[e.jsx("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"í”„ë¡œì íŠ¸ ì„¤ì •"]}),e.jsx("div",{className:"text-gray-400",children:"|"}),e.jsx("h1",{className:"text-white font-bold",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"ghost",size:"sm",onClick:ze,disabled:!ve,className:ve?"":"opacity-50 cursor-not-allowed",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"bg-gray-700 rounded-lg px-4 py-2 min-w-[200px] text-center",children:[e.jsx("span",{className:"text-purple-400 font-bold",children:i?`${i.episodeNumber}í™”`:"ì—í”¼ì†Œë“œ ì„ íƒ"}),i&&e.jsxs("span",{className:"text-gray-400 ml-2 text-sm",children:["/ ",t.episodes.length,"í™”"]})]}),e.jsx(D,{variant:"ghost",size:"sm",onClick:Be,disabled:!we,className:we?"":"opacity-50 cursor-not-allowed",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"flex items-center gap-2",children:be?e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"})}),e.jsx("span",{children:"ìë™ ë™ê¸°í™” ì¤‘"})]}):e.jsxs("button",{onClick:()=>g("/settings"),className:"flex items-center gap-2 text-gray-400 hover:text-white text-sm transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"})}),e.jsx("span",{children:"ë¡œê·¸ì¸í•˜ì—¬ ë™ê¸°í™”"})]})})]}),e.jsx(bs,{projectTitle:t.title,episodeTitle:(i==null?void 0:i.title)||"ì—í”¼ì†Œë“œ ì„ íƒ",onSave:()=>y({message:"ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ (ìë™ ì €ì¥ë¨)",type:"success"}),onPreview:()=>g(`/preview/${s}`),onExport:async()=>{if(!i){y({message:"ì—í”¼ì†Œë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”",type:"error"});return}if(i.panels.filter(w=>{var j;return(j=w.generatedImage)==null?void 0:j.imageData}).length===0){y({message:"ë‚´ë³´ë‚¼ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤",type:"error"});return}try{y({message:"ì´ë¯¸ì§€ë¥¼ ë³‘í•©í•˜ê³  ìˆìŠµë‹ˆë‹¤...",type:"info"}),await ks(i,{format:"long-image"}),y({message:"ë‚´ë³´ë‚´ê¸° ì™„ë£Œ!",type:"success"})}catch(w){console.error("Export failed:",w),y({message:"ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",type:"error"})}}}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"w-64 bg-gray-800/50 border-r border-gray-700 p-4 overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"ì—í”¼ì†Œë“œ"}),e.jsx("div",{className:"space-y-2",children:t.episodes.length>0?t.episodes.map(a=>e.jsxs(se.button,{whileHover:{x:4},onClick:()=>{S(a.id),a.panels.length>0&&f(a.panels[0].id)},className:`w-full text-left p-3 rounded-lg transition-colors ${m===a.id?"bg-purple-600/30 border border-purple-500":"bg-gray-700/50 hover:bg-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-medium",children:[a.episodeNumber,"í™”"]}),e.jsxs("span",{className:"text-gray-400 text-sm",children:[a.panels.length," íŒ¨ë„"]})]}),e.jsx("p",{className:"text-gray-400 text-sm truncate mt-1",children:a.title})]},a.id)):e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("p",{children:"ì—í”¼ì†Œë“œê°€ ì—†ìŠµë‹ˆë‹¤"}),e.jsx(D,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>{},children:"ì—í”¼ì†Œë“œ ì¶”ê°€"})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"ìºë¦­í„°"}),e.jsx("div",{className:"space-y-2",children:t.characters.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-gray-700/30",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-sm",children:a.gender==="female"?"ğŸ‘©":"ğŸ‘¨"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm font-medium",children:a.name}),e.jsx("p",{className:"text-gray-400 text-xs",children:a.role})]})]},a.id))})]})]}),e.jsx("div",{className:"flex-1 flex flex-col p-4 overflow-hidden",children:i?e.jsxs(e.Fragment,{children:[e.jsx(ys,{panels:i.panels,selectedPanelId:n,onSelectPanel:f,onDeletePanel:De,onDeleteAllPanels:Re}),e.jsxs("div",{className:"flex-1 mt-4 overflow-y-auto",children:[E?e.jsx(fs,{panel:E,episodeId:i.id,onUpdate:a=>ge(E.id,a)}):e.jsx(Ve,{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-4xl mb-4 block",children:"ğŸ¬"}),e.jsx("p",{className:"text-gray-400 mb-2",children:i.panels.length===0?"ì´ ì—í”¼ì†Œë“œì— íŒ¨ë„ì´ ì—†ìŠµë‹ˆë‹¤":"íŒ¨ë„ì„ ì„ íƒí•˜ê±°ë‚˜ ìƒˆë¡œ ì¶”ê°€í•˜ì„¸ìš”"}),i.panels.length===0&&e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"AIê°€ ì—í”¼ì†Œë“œ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ íŒ¨ë„ì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤"}),e.jsx(D,{variant:"primary",className:"mt-4",onClick:Le,disabled:B,loading:B,children:B?"AI íŒ¨ë„ ìƒì„± ì¤‘...":"AI íŒ¨ë„ ìë™ ìƒì„±"})]})}),i.panels.length>0&&e.jsxs("div",{className:"mt-4 flex gap-2 justify-center",children:[e.jsx(D,{variant:"secondary",size:"sm",onClick:Oe,disabled:B,children:"ğŸ” ë¹ ì§„ íŒ¨ë„ í™•ì¸"}),e.jsxs(D,{variant:"secondary",size:"sm",onClick:()=>{const a=$e();a.length>0?(me(a),b(!0)):y({message:"ì´ë¯¸ 70ê°œ íŒ¨ë„ì´ ëª¨ë‘ ìˆìŠµë‹ˆë‹¤!",type:"success"})},disabled:B,loading:B,children:["â• íŒ¨ë„ ì¶”ê°€ ìƒì„± (",70-((i==null?void 0:i.panels.length)||0),"ê°œ ë‚¨ìŒ)"]})]})]})]}):e.jsx(Ve,{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-4xl mb-4 block",children:"ğŸ“š"}),e.jsx("p",{className:"text-gray-400",children:"ì—í”¼ì†Œë“œë¥¼ ì„ íƒí•˜ì„¸ìš”"})]})})}),e.jsxs("div",{className:"w-72 bg-gray-800/50 border-l border-gray-700 p-4 overflow-y-auto",children:[e.jsx(as,{tabs:[{id:"properties",label:"ì†ì„±"},{id:"dialogue",label:"ëŒ€ì‚¬"}],activeTab:"properties",onChange:()=>{},variant:"underline",fullWidth:!0}),e.jsx("div",{className:"mt-4",children:E?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"íŒ¨ë„ í¬ê¸°"}),e.jsx("p",{className:"text-white",children:{full:"ì „ì²´",large:"ëŒ€í˜•",medium:"ì¤‘í˜•",small:"ì†Œí˜•",wide:"ê°€ë¡œí˜•",tall:"ì„¸ë¡œí˜•",custom:"ì»¤ìŠ¤í…€"}[E.size]||E.size})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ì¹´ë©”ë¼ ì•µê¸€"}),e.jsx("p",{className:"text-white",children:{"close-up":"í´ë¡œì¦ˆì—…","extreme-close-up":"ìµìŠ¤íŠ¸ë¦¼ í´ë¡œì¦ˆì—…","medium-shot":"ë¯¸ë””ì—„ìƒ·","wide-shot":"ì™€ì´ë“œìƒ·","bird-eye":"ë²„ë“œì•„ì´","worm-eye":"ì›œì•„ì´","dutch-angle":"ë”ì¹˜ì•µê¸€","over-shoulder":"ì˜¤ë²„ìˆ„ë”",pov:"POV"}[E.cameraAngle]||E.cameraAngle})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ë¶„ìœ„ê¸°"}),e.jsx("p",{className:"text-white",children:{happy:"ë°ìŒ ğŸ˜Š",sad:"ìŠ¬í”” ğŸ˜¢",angry:"ë¶„ë…¸ ğŸ˜ ",romantic:"ë¡œë§¨í‹± ğŸ’•",tense:"ê¸´ì¥ ğŸ˜°",mysterious:"ë¯¸ìŠ¤í„°ë¦¬ ğŸ”®",comedic:"ì½”ë¯¹ ğŸ˜‚",peaceful:"í‰í™” ğŸŒ¿",dramatic:"ê·¹ì  ğŸ­",nostalgic:"í–¥ìˆ˜ ğŸŒ…"}[E.mood]||E.mood||"ì—†ìŒ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ì¡°ëª…"}),e.jsx("p",{className:"text-white",children:{natural:"ìì—°ê´‘ â˜€ï¸",sunset:"ì„ì–‘ ğŸŒ…",night:"ì•¼ê°„ ğŸŒ™",indoor:"ì‹¤ë‚´ ğŸ’¡",dramatic:"ê·¹ì  ğŸ¬",soft:"ì†Œí”„íŠ¸ ğŸŒ¤ï¸",backlight:"ì—­ê´‘ âœ¨",neon:"ë„¤ì˜¨ ğŸŒˆ"}[E.lighting]||E.lighting})]}),E.dialogues.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"ëŒ€ì‚¬"}),e.jsx("div",{className:"space-y-2",children:E.dialogues.map(a=>e.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-purple-400",children:a.characterName||"ë‚˜ë ˆì´ì…˜"}),e.jsx("p",{className:"text-white text-sm",children:a.text})]},a.id))})]})]}):e.jsx("p",{className:"text-gray-400 text-center",children:"íŒ¨ë„ì„ ì„ íƒí•˜ì„¸ìš”"})})]})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:e.jsxs(se.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4 border border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"ğŸ” ë¹ ì§„ íŒ¨ë„ ë°œê²¬"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"ë‹¤ìŒ íŒ¨ë„ ë²ˆí˜¸ê°€ ë¹ ì ¸ìˆìŠµë‹ˆë‹¤:"}),e.jsx("div",{className:"bg-gray-900 rounded-lg p-4 mb-4 max-h-48 overflow-y-auto",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:re.map(a=>e.jsxs("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm font-medium",children:["#",a]},a))})}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["ì´ ",re.length,"ê°œì˜ íŒ¨ë„ì´ ë¹ ì ¸ìˆìŠµë‹ˆë‹¤. AIê°€ ì•ë’¤ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì°¸ê³ í•˜ì—¬ ë¹ ì§„ íŒ¨ë„ì„ ìƒì„±í•©ë‹ˆë‹¤."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(D,{variant:"primary",className:"flex-1",onClick:()=>Me(re),disabled:B,loading:B,children:"ë¹ ì§„ íŒ¨ë„ ìƒì„±"}),e.jsx(D,{variant:"secondary",onClick:()=>b(!1),children:"ì·¨ì†Œ"})]})]})})]})};export{Rs as default};
